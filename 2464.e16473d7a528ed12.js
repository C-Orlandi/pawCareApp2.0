"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2464],{2464:(v,h,s)=>{s.r(h),s.d(h,{GestionarUsuarioPage:()=>j});var g=s(467),n=s(3092),p=s(2881),l=s(9417),c=s(3273),o=s(1360),f=s(651),b=s(9967),U=s(4796),F=s(9506);let C=(()=>{var t;class d{constructor(e,i,r,a,m){this.modalCtrl=e,this.duenoService=i,this.firestore=r,this.authService=a,this.alertController=m,this.nombre="",this.email="",this.pass="",this.contacto="",this.tipo="dueno"}ngOnInit(){this.usuario&&(this.nombre=this.usuario.nombre,this.email=this.usuario.email,this.pass=this.usuario.pass,this.tipo=this.usuario.tipo)}guardar(){var e=this;return(0,g.A)(function*(){try{if(e.usuario){const i={uid:e.usuario.uid,nombre:e.nombre,email:e.email,pass:e.pass,contacto:e.contacto,tipo:e.tipo};yield(0,c.BN)((0,c.H9)(e.firestore,"usuarios",i.uid),i),yield(0,c.BN)((0,c.H9)(e.firestore,"duenos",i.uid),{uid:i.uid,nombre:e.nombre,email:e.email,creadoEn:new Date}),yield e.authService.actualizarUsuarioEnAuth(i.uid,i.email,i.pass).toPromise(),e.modalCtrl.dismiss(i)}else{const r=(yield e.authService.register(e.email,e.pass)).user;if(!r)throw new Error("No se pudo crear el usuario en Auth");const a={uid:r.uid,nombre:e.nombre,email:e.email,pass:e.pass,contacto:e.contacto,tipo:e.tipo};yield(0,c.BN)((0,c.H9)(e.firestore,"usuarios",r.uid),a),yield(0,c.BN)((0,c.H9)(e.firestore,"duenos",r.uid),{uid:r.uid,nombre:e.nombre,email:e.email,creadoEn:new Date}),e.modalCtrl.dismiss(a)}}catch(i){console.error("\u274c Error al guardar usuario:",i),e.alertController.create({header:"Error",message:(null==i?void 0:i.message)||"No se pudo guardar el usuario.",buttons:["OK"]}).then(r=>r.present())}})()}cerrar(){this.modalCtrl.dismiss(!1)}generarPasswordAleatoria(e=10){let r="";for(let a=0;a<e;a++){const m=Math.floor(66*Math.random());r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789@#$%".charAt(m)}this.pass=r}}return(t=d).\u0275fac=function(e){return new(e||t)(o.rXU(n.W3),o.rXU(f.p),o.rXU(b._7),o.rXU(U.u),o.rXU(F.hG))},t.\u0275cmp=o.VBU({type:t,selectors:[["app-modal-usuario"]],inputs:{usuario:"usuario"},decls:42,vars:7,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit"],["lines","inset"],["position","floating"],["color","danger"],["name","nombre","required","",3,"ngModelChange","ngModel"],["type","email","name","email","required","",3,"ngModelChange","ngModel"],["type","text","name","pass","required","",3,"ngModelChange","ngModel"],["lines","none"],["expand","block","size","small","fill","outline",3,"click"],["position","stacked"],["name","tipo","interface","popover","placeholder","Seleccionar...",3,"ngModelChange","ngModel"],["value","dueno"],["expand","block","shape","round","size","large","type","submit","color","dark",1,"ion-margin-top",3,"disabled"]],template:function(e,i){1&e&&(o.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),o.EFF(3),o.k0s(),o.j41(4,"ion-buttons",1)(5,"ion-button",2),o.bIt("click",function(){return i.cerrar()}),o.EFF(6,"Cerrar"),o.k0s()()()(),o.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),o.bIt("ngSubmit",function(){return i.guardar()}),o.j41(11,"ion-item",5)(12,"ion-label",6),o.EFF(13,"Nombre "),o.j41(14,"ion-text",7),o.EFF(15,"*"),o.k0s()(),o.j41(16,"ion-input",8),o.mxI("ngModelChange",function(a){return o.DH7(i.nombre,a)||(i.nombre=a),a}),o.k0s()(),o.j41(17,"ion-item",5)(18,"ion-label",6),o.EFF(19,"Email "),o.j41(20,"ion-text",7),o.EFF(21,"*"),o.k0s()(),o.j41(22,"ion-input",9),o.mxI("ngModelChange",function(a){return o.DH7(i.email,a)||(i.email=a),a}),o.k0s()(),o.j41(23,"ion-item",5)(24,"ion-label",6),o.EFF(25,"Contrase\xf1a "),o.j41(26,"ion-text",7),o.EFF(27,"*"),o.k0s()(),o.j41(28,"ion-input",10),o.mxI("ngModelChange",function(a){return o.DH7(i.pass,a)||(i.pass=a),a}),o.k0s()(),o.j41(29,"ion-item",11)(30,"ion-button",12),o.bIt("click",function(){return i.generarPasswordAleatoria()}),o.EFF(31,"Generar Contrase\xf1a Aleatoria"),o.k0s()(),o.j41(32,"ion-item",5)(33,"ion-label",13),o.EFF(34,"Tipo "),o.j41(35,"ion-text",7),o.EFF(36,"*"),o.k0s()(),o.j41(37,"ion-select",14),o.mxI("ngModelChange",function(a){return o.DH7(i.tipo,a)||(i.tipo=a),a}),o.j41(38,"ion-select-option",15),o.EFF(39,"Due\xf1o"),o.k0s()()(),o.j41(40,"ion-button",16),o.EFF(41),o.k0s()()()()()),2&e&&(o.R7$(3),o.JRh(i.usuario?"Editar Usuario":"Nuevo Usuario"),o.R7$(13),o.R50("ngModel",i.nombre),o.R7$(6),o.R50("ngModel",i.email),o.R7$(6),o.R50("ngModel",i.pass),o.R7$(9),o.R50("ngModel",i.tipo),o.R7$(3),o.Y8G("disabled",!i.nombre||!i.email||!i.pass),o.R7$(),o.SpI(" ",i.usuario?"Actualizar":"Crear"," "))},dependencies:[n.bv,n.Jm,n.QW,n.b_,n.I9,n.W9,n.eU,n.$w,n.uz,n.he,n.Nm,n.Ip,n.IO,n.BC,n.ai,n.Je,n.Gw,p.MD,l.YN,l.qT,l.BC,l.cb,l.YS,l.vS,l.cV],encapsulation:2}),d})();var M=s(8570);function _(t,d){if(1&t){const u=o.RV6();o.j41(0,"ion-item")(1,"ion-label")(2,"h2"),o.EFF(3),o.k0s(),o.j41(4,"p"),o.EFF(5),o.k0s(),o.j41(6,"p"),o.EFF(7),o.k0s()(),o.j41(8,"ion-button",6),o.bIt("click",function(){const i=o.eBV(u).$implicit,r=o.XpG();return o.Njj(r.abrirModal(i))}),o.nrm(9,"ion-icon",7),o.k0s(),o.j41(10,"ion-button",8),o.bIt("click",function(){const i=o.eBV(u).$implicit,r=o.XpG();return o.Njj(r.eliminarUsuario(i.uid))}),o.nrm(11,"ion-icon",9),o.k0s()()}if(2&t){const u=d.$implicit,e=o.XpG();o.R7$(3),o.JRh(u.nombre),o.R7$(2),o.SpI("Email: ",u.email,""),o.R7$(2),o.SpI("Tipo: ",e.getTipoLegible(u.tipo),"")}}function k(t,d){1&t&&(o.j41(0,"p",10),o.EFF(1,"No hay usuarios registrados."),o.k0s())}let j=(()=>{var t;class d{constructor(e,i){this.usuariosService=e,this.modalController=i,this.usuarios=[]}ngOnInit(){this.usuariosService.getUsuarios().subscribe(e=>{this.usuarios=e.filter(i=>"dueno"===i.tipo)})}abrirModal(e){var i=this;return(0,g.A)(function*(){const r=yield i.modalController.create({component:C,componentProps:{usuario:e}});r.onDidDismiss().then(a=>{if(a.data){const m=a.data;e?i.usuariosService.actualizarUsuario(m):i.usuariosService.crearUsuario(m)}}),yield r.present()})()}eliminarUsuario(e){var i=this;return(0,g.A)(function*(){if(confirm("\xbfSeguro que quieres eliminar este usuario?"))try{yield i.usuariosService.eliminarUsuario(e),alert("Usuario eliminado correctamente")}catch(r){alert("Error al eliminar usuario: "+r)}})()}getTipoLegible(e){switch(e){case"dueno":return"Due\xf1o";case"admin":return"Admin";case"otro":return"Otro";default:return e}}}return(t=d).\u0275fac=function(e){return new(e||t)(o.rXU(M.d),o.rXU(n.W3))},t.\u0275cmp=o.VBU({type:t,selectors:[["app-gestionar-usuario"]],decls:11,vars:2,consts:[["slot","end"],[3,"click"],["slot","add"],[1,"ion-padding"],[4,"ngFor","ngForOf"],["class","ion-text-center",4,"ngIf"],["slot","end","color","warning","size","small",3,"click"],["name","create"],["slot","end","color","danger","size","small",3,"click"],["name","trash","slot","icon-only"],[1,"ion-text-center"]],template:function(e,i){1&e&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),o.EFF(3,"Gestionar Usuarios"),o.k0s(),o.j41(4,"ion-buttons",0)(5,"ion-button",1),o.bIt("click",function(){return i.abrirModal()}),o.nrm(6,"ion-buttons",2),o.k0s()()()(),o.j41(7,"ion-content",3)(8,"ion-list"),o.DNE(9,_,12,3,"ion-item",4),o.k0s(),o.DNE(10,k,2,0,"p",5),o.k0s()),2&e&&(o.R7$(9),o.Y8G("ngForOf",i.usuarios),o.R7$(),o.Y8G("ngIf",0===i.usuarios.length))},dependencies:[n.bv,n.Jm,n.QW,n.W9,n.eU,n.iq,n.uz,n.he,n.nf,n.BC,n.ai,p.MD,p.Sq,p.bT,l.YN],encapsulation:2}),d})()}}]);