"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7067],{7067:(K,C,p)=>{p.r(C),p.d(C,{ControlpycPage:()=>W});var u=p(467),f=p(2881),c=p(9417),i=p(3092),v=p(8032),_=p.n(v),o=p(1360),h=p(9967),d=p(3273);let F=(()=>{var e;class l{constructor(t){this.firestore=t}obtenerControles(t){const n=(0,d.rJ)(this.firestore,"controlPesoCrecimiento"),r=(0,d.P)(n,(0,d._M)("mid","==",t),(0,d.My)("fecha","desc"));return(0,h.xs)(r,{idField:"cid"})}agregarControl(t){var n=this;return(0,u.A)(function*(){const r=yield(0,d.gS)((0,d.rJ)(n.firestore,"controlPesoCrecimiento"),t);yield(0,d.mZ)((0,d.H9)(n.firestore,"controlPesoCrecimiento",r.id),{cid:r.id})})()}actualizarControl(t,n){var r=this;return(0,u.A)(function*(){const s=(0,d.H9)(r.firestore,"controlPesoCrecimiento",t);yield(0,d.mZ)(s,n)})()}eliminarControl(t){var n=this;return(0,u.A)(function*(){yield(0,d.kd)((0,d.H9)(n.firestore,"controlPesoCrecimiento",t))})()}}return(e=l).\u0275fac=function(t){return new(t||e)(o.KVO(h._7))},e.\u0275prov=o.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),l})();var E=p(9506);function k(e,l){1&e&&(o.j41(0,"ion-text",7)(1,"p",18),o.EFF(2,"La fecha es obligatoria."),o.k0s()())}function b(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"El peso es obligatorio."),o.k0s())}function j(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Debe ser un n\xfamero v\xe1lido."),o.k0s())}function I(e,l){if(1&e&&(o.j41(0,"ion-text",7),o.DNE(1,b,2,0,"p",19)(2,j,2,0,"p",19),o.k0s()),2&e){let a,t;const n=o.XpG();o.R7$(),o.Y8G("ngIf",null==(a=n.formulario.get("peso"))?null:a.hasError("required")),o.R7$(),o.Y8G("ngIf",null==(t=n.formulario.get("peso"))?null:t.hasError("pattern"))}}function $(e,l){1&e&&(o.j41(0,"ion-text",7)(1,"p",18),o.EFF(2,"La unidad es obligatoria."),o.k0s()())}function T(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Este campo es obligatorio."),o.k0s())}function S(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Solo letras y espacios permitidos."),o.k0s())}function R(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Debe tener al menos 3 caracteres."),o.k0s())}function G(e,l){if(1&e&&(o.j41(0,"ion-text",7),o.DNE(1,T,2,0,"p",19)(2,S,2,0,"p",19)(3,R,2,0,"p",19),o.k0s()),2&e){let a,t,n;const r=o.XpG();o.R7$(),o.Y8G("ngIf",null==(a=r.formulario.get("condicionCorporal"))?null:a.hasError("required")),o.R7$(),o.Y8G("ngIf",null==(t=r.formulario.get("condicionCorporal"))?null:t.hasError("pattern")),o.R7$(),o.Y8G("ngIf",null==(n=r.formulario.get("condicionCorporal"))?null:n.hasError("minlength"))}}function D(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Este campo es obligatorio."),o.k0s())}function M(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Solo letras y espacios permitidos."),o.k0s())}function N(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Debe tener al menos 3 caracteres."),o.k0s())}function P(e,l){if(1&e&&(o.j41(0,"ion-text",7),o.DNE(1,D,2,0,"p",19)(2,M,2,0,"p",19)(3,N,2,0,"p",19),o.k0s()),2&e){let a,t,n;const r=o.XpG();o.R7$(),o.Y8G("ngIf",null==(a=r.formulario.get("actividadFisica"))?null:a.hasError("required")),o.R7$(),o.Y8G("ngIf",null==(t=r.formulario.get("actividadFisica"))?null:t.hasError("pattern")),o.R7$(),o.Y8G("ngIf",null==(n=r.formulario.get("actividadFisica"))?null:n.hasError("minlength"))}}function Y(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Este campo es obligatorio."),o.k0s())}function A(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Solo letras y espacios permitidos."),o.k0s())}function X(e,l){1&e&&(o.j41(0,"p",18),o.EFF(1,"Debe tener al menos 3 caracteres."),o.k0s())}function O(e,l){if(1&e&&(o.j41(0,"ion-text",7),o.DNE(1,Y,2,0,"p",19)(2,A,2,0,"p",19)(3,X,2,0,"p",19),o.k0s()),2&e){let a,t,n;const r=o.XpG();o.R7$(),o.Y8G("ngIf",null==(a=r.formulario.get("observaciones"))?null:a.hasError("required")),o.R7$(),o.Y8G("ngIf",null==(t=r.formulario.get("observaciones"))?null:t.hasError("pattern")),o.R7$(),o.Y8G("ngIf",null==(n=r.formulario.get("observaciones"))?null:n.hasError("minlength"))}}let B=(()=>{var e;class l{constructor(t,n,r,s){this.modalController=t,this.fb=n,this.controlService=r,this.loadingController=s,this.esEdicion=!1}ngOnInit(){var t;this.formulario=this.fb.group({fecha:[(null===(t=this.control)||void 0===t?void 0:t.fecha)||(new Date).toISOString(),c.k0.required],peso:["",[c.k0.required,c.k0.pattern(/^\d+(\.\d+)?$/)]],unidad:["",c.k0.required],condicionCorporal:["",[c.k0.required,c.k0.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/),c.k0.minLength(3)]],actividadFisica:["",[c.k0.required,c.k0.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/),c.k0.minLength(3)]],observaciones:["",[c.k0.required,c.k0.pattern(/^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1\s]+$/),c.k0.minLength(3)]]}),this.esEdicion=!!this.control}guardar(){var t=this;return(0,u.A)(function*(){if(t.formulario.invalid)return void _().fire({icon:"warning",title:"Formulario inv\xe1lido",text:"Por favor completa todos los campos correctamente.",confirmButtonText:"OK",heightAuto:!1});const n=yield t.loadingController.create({message:"Cargando...",spinner:"circles"});yield n.present();const r={...t.formulario.value,mid:t.mid};try{t.esEdicion?yield t.controlService.actualizarControl(t.control.cid,r):yield t.controlService.agregarControl(r),yield n.dismiss(),_().fire({icon:"success",title:t.esEdicion?"Registro Actualizado":"Registro Exitoso",text:t.esEdicion?"El registro fue actualizado correctamente.":"El registro fue guardado correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>{t.modalController.dismiss(!0)})}catch(s){console.error("\u274c Error al guardar el control:",s),yield n.dismiss(),_().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al guardar el registro. Intenta nuevamente.",confirmButtonText:"OK",heightAuto:!1})}})()}cerrar(){this.modalController.dismiss(!1)}}return(e=l).\u0275fac=function(t){return new(t||e)(o.rXU(i.W3),o.rXU(c.ok),o.rXU(F),o.rXU(E.Xi))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-modal-controlpyc"]],inputs:{control:"control",mid:"mid"},decls:59,vars:10,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","fecha","presentation","date"],["color","danger",4,"ngIf"],["type","number","formControlName","peso"],["formControlName","unidad","placeholder","Seleccionar..."],["value","kg"],["value","g"],["formControlName","condicionCorporal"],["formControlName","actividadFisica"],["formControlName","observaciones"],["expand","block","shape","round","size","large","type","submit","color","dark",1,"ion-margin-top",3,"disabled"],[1,"ion-padding-start"],["class","ion-padding-start",4,"ngIf"]],template:function(t,n){if(1&t&&(o.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),o.EFF(3),o.k0s(),o.j41(4,"ion-buttons",1)(5,"ion-button",2),o.bIt("click",function(){return n.cerrar()}),o.EFF(6,"Cerrar"),o.k0s()()()(),o.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),o.bIt("ngSubmit",function(){return n.guardar()}),o.j41(11,"ion-item",5)(12,"ion-label",6),o.EFF(13,"Fecha "),o.j41(14,"ion-text",7),o.EFF(15,"*"),o.k0s()(),o.nrm(16,"ion-datetime",8),o.k0s(),o.DNE(17,k,3,0,"ion-text",9),o.j41(18,"ion-item",5)(19,"ion-label",6),o.EFF(20,"Peso "),o.j41(21,"ion-text",7),o.EFF(22,"*"),o.k0s()(),o.nrm(23,"ion-input",10),o.k0s(),o.DNE(24,I,3,2,"ion-text",9),o.j41(25,"ion-item",5)(26,"ion-label"),o.EFF(27,"Unidad "),o.j41(28,"ion-text",7),o.EFF(29,"*"),o.k0s()(),o.j41(30,"ion-select",11)(31,"ion-select-option",12),o.EFF(32,"kg"),o.k0s(),o.j41(33,"ion-select-option",13),o.EFF(34,"g"),o.k0s()()(),o.DNE(35,$,3,0,"ion-text",9),o.j41(36,"ion-item",5)(37,"ion-label",6),o.EFF(38,"Condici\xf3n Corporal "),o.j41(39,"ion-text",7),o.EFF(40,"*"),o.k0s()(),o.nrm(41,"ion-input",14),o.k0s(),o.DNE(42,G,4,3,"ion-text",9),o.j41(43,"ion-item",5)(44,"ion-label",6),o.EFF(45,"Actividad F\xedsica "),o.j41(46,"ion-text",7),o.EFF(47,"*"),o.k0s()(),o.nrm(48,"ion-input",15),o.k0s(),o.DNE(49,P,4,3,"ion-text",9),o.j41(50,"ion-item",5)(51,"ion-label",6),o.EFF(52,"Observaciones "),o.j41(53,"ion-text",7),o.EFF(54,"*"),o.k0s()(),o.nrm(55,"ion-textarea",16),o.k0s(),o.DNE(56,O,4,3,"ion-text",9),o.j41(57,"ion-button",17),o.EFF(58),o.k0s()()()()()),2&t){let r,s,m,g,y,x;o.R7$(3),o.SpI("",n.esEdicion?"Editar":"Nuevo"," Registro"),o.R7$(7),o.Y8G("formGroup",n.formulario),o.R7$(7),o.Y8G("ngIf",(null==(r=n.formulario.get("fecha"))?null:r.hasError("required"))&&(null==(r=n.formulario.get("fecha"))?null:r.touched)),o.R7$(7),o.Y8G("ngIf",null==(s=n.formulario.get("peso"))?null:s.touched),o.R7$(11),o.Y8G("ngIf",(null==(m=n.formulario.get("unidad"))?null:m.hasError("required"))&&(null==(m=n.formulario.get("unidad"))?null:m.touched)),o.R7$(7),o.Y8G("ngIf",null==(g=n.formulario.get("condicionCorporal"))?null:g.touched),o.R7$(7),o.Y8G("ngIf",null==(y=n.formulario.get("actividadFisica"))?null:y.touched),o.R7$(7),o.Y8G("ngIf",null==(x=n.formulario.get("observaciones"))?null:x.touched),o.R7$(),o.Y8G("disabled",n.formulario.invalid),o.R7$(),o.SpI(" ",n.esEdicion?"Actualizar":"Guardar"," Registro ")}},dependencies:[f.MD,f.bT,i.bv,i.Jm,i.QW,i.b_,i.I9,i.W9,i.A9,i.eU,i.$w,i.uz,i.he,i.Nm,i.Ip,i.IO,i.nc,i.BC,i.ai,i.su,i.Je,i.Gw,c.X1,c.qT,c.BC,c.cb,c.j4,c.JD],styles:["ion-button[_ngcontent-%COMP%]{margin-top:12px;font-size:15px;letter-spacing:.5px;border-radius:12px}"]}),l})();var U=p(5391);function z(e,l){if(1&e&&(o.j41(0,"p"),o.EFF(1),o.k0s()),2&e){const a=o.XpG().$implicit;o.R7$(),o.JRh(a.observaciones)}}function J(e,l){if(1&e){const a=o.RV6();o.j41(0,"ion-item",10),o.bIt("click",function(){const n=o.eBV(a).$implicit,r=o.XpG(2);return o.Njj(r.abrirModalControl(n))}),o.j41(1,"ion-label")(2,"h2",11),o.EFF(3),o.k0s(),o.j41(4,"p"),o.EFF(5),o.k0s(),o.DNE(6,z,2,1,"p",9),o.k0s(),o.j41(7,"ion-button",12),o.bIt("click",function(n){const r=o.eBV(a).$implicit;return o.XpG(2).eliminarControl(r.cid),o.Njj(n.stopPropagation())}),o.nrm(8,"ion-icon",13),o.k0s()()}if(2&e){const a=l.$implicit,t=o.XpG(2);o.R7$(3),o.SpI("",a.peso," kg"),o.R7$(2),o.SpI("\u{1f4c5} ",t.formatearFechaHora(a.fecha),""),o.R7$(),o.Y8G("ngIf",a.observaciones)}}function V(e,l){1&e&&(o.j41(0,"ion-item")(1,"ion-label",14),o.EFF(2,"No hay registros de control."),o.k0s()())}function H(e,l){if(1&e&&(o.j41(0,"ion-list"),o.DNE(1,J,9,3,"ion-item",8)(2,V,3,0,"ion-item",9),o.k0s()),2&e){const a=l.ngIf;o.R7$(),o.Y8G("ngForOf",a),o.R7$(),o.Y8G("ngIf",0===a.length)}}function L(e,l){1&e&&(o.j41(0,"div",15),o.nrm(1,"ion-spinner",16),o.j41(2,"p",14),o.EFF(3,"Cargando controles..."),o.k0s()())}let W=(()=>{var e;class l{constructor(t,n,r,s,m){this.controlService=t,this.modalController=n,this.alertController=r,this.exportarpdf=s,this.loadingController=m,this.controles=[]}ngOnInit(){const t=localStorage.getItem("mascotaSeleccionada");t&&(this.mascotaSeleccionada=JSON.parse(t),this.cargarControles())}cargarControles(){this.controles$=this.controlService.obtenerControles(this.mascotaSeleccionada.mid),this.controles$.subscribe(t=>{this.controles=t||[]})}abrirModalControl(t){var n=this;return(0,u.A)(function*(){const r=yield n.modalController.create({component:B,componentProps:{control:t,mid:n.mascotaSeleccionada.mid}});r.onDidDismiss().then(s=>{s.data&&n.cargarControles()}),yield r.present()})()}eliminarControl(t){var n=this;return(0,u.A)(function*(){var s;yield(yield n.alertController.create({header:"Eliminar Registro",message:"\xbfDeseas eliminar este registro?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(s=(0,u.A)(function*(){const m=yield n.loadingController.create({message:"Eliminando...",spinner:"crescent"});yield m.present();try{yield n.controlService.eliminarControl(t),n.cargarControles(),yield m.dismiss(),_().fire({icon:"success",title:"Registro eliminado",text:"El registro fue eliminado correctamente.",confirmButtonText:"OK",heightAuto:!1})}catch{yield m.dismiss(),_().fire({icon:"error",title:"Error",text:"No se pudo eliminar el registro.",confirmButtonText:"OK",heightAuto:!1})}}),function(){return s.apply(this,arguments)})}]})).present()})()}formatearFechaHora(t){if(!t)return"N/A";const n=new Date(t);return`${n.toLocaleDateString("es-CL")} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`}exportarPDF(){var t;this.exportarpdf.exportarControles(this.controles,null===(t=this.mascotaSeleccionada)||void 0===t?void 0:t.nombre,this.formatearFechaHora)}}return(e=l).\u0275fac=function(t){return new(t||e)(o.rXU(F),o.rXU(i.W3),o.rXU(i.hG),o.rXU(U.n),o.rXU(E.Xi))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-controlpyc"]],decls:15,vars:4,consts:[["cargando",""],["color","tertiary"],["slot","end"],[3,"click"],["name","download-outline","slot","start"],["name","add","slot","icon-only"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["lines","inset","button","","class","vacuna-item",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["lines","inset","button","",1,"vacuna-item",3,"click"],[1,"titulo"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash"],[1,"ion-text-center"],[1,"cargando-spinner"],["name","crescent"]],template:function(t,n){if(1&t){const r=o.RV6();o.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),o.EFF(3,"Control de Peso y Crecimiento"),o.k0s(),o.j41(4,"ion-buttons",2)(5,"ion-button",3),o.bIt("click",function(){return o.eBV(r),o.Njj(n.exportarPDF())}),o.nrm(6,"ion-icon",4),o.EFF(7," Exportar PDF "),o.k0s(),o.j41(8,"ion-button",3),o.bIt("click",function(){return o.eBV(r),o.Njj(n.abrirModalControl())}),o.nrm(9,"ion-icon",5),o.k0s()()()(),o.j41(10,"ion-content",6),o.DNE(11,H,3,2,"ion-list",7),o.nI1(12,"async"),o.DNE(13,L,4,0,"ng-template",null,0,o.C5r),o.k0s()}if(2&t){const r=o.sdS(14);o.R7$(11),o.Y8G("ngIf",o.bMT(12,2,n.controles$))("ngIfElse",r)}},dependencies:[f.MD,f.Sq,f.bT,f.Jj,i.bv,i.Jm,i.QW,i.W9,i.eU,i.iq,i.uz,i.he,i.nf,i.w2,i.BC,i.ai,c.YN],styles:[".cargando-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center}"]}),l})()}}]);