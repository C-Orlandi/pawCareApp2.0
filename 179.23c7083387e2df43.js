"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[179],{2560:(H,_,l)=>{l.r(_),l.d(_,{VacunasPage:()=>A});var g=l(467),v=l(2881),m=l(9417),r=l(3092),f=l(9967),V=l(9107),x=l(7239),b=l.n(x),y=l(8032),h=l.n(y),a=l(1360),E=l(1334),C=l(9506);function j(o,c){1&o&&(a.j41(0,"p",13),a.EFF(1,"El nombre es obligatorio."),a.k0s())}function M(o,c){1&o&&(a.j41(0,"p",13),a.EFF(1,"Debe tener al menos 3 letras."),a.k0s())}function S(o,c){1&o&&(a.j41(0,"p",13),a.EFF(1,"Solo se permiten letras."),a.k0s())}function I(o,c){if(1&o&&(a.j41(0,"ion-text",7),a.DNE(1,j,2,0,"p",12)(2,M,2,0,"p",12)(3,S,2,0,"p",12),a.k0s()),2&o){let s,n,t;const e=a.XpG();a.R7$(),a.Y8G("ngIf",null==(s=e.vacunaForm.get("nombre"))||null==s.errors?null:s.errors.required),a.R7$(),a.Y8G("ngIf",null==(n=e.vacunaForm.get("nombre"))||null==n.errors?null:n.errors.minlength),a.R7$(),a.Y8G("ngIf",null==(t=e.vacunaForm.get("nombre"))||null==t.errors?null:t.errors.pattern)}}function k(o,c){1&o&&(a.j41(0,"ion-text",7)(1,"p",13),a.EFF(2,"La fecha es obligatoria."),a.k0s()())}let P=(()=>{var o;class c{constructor(n,t,e,i,u,p){this.fb=n,this.firestore=t,this.toastController=e,this.modalCtrl=i,this.emailService=u,this.loadingController=p,this.usuarioEmail="sin-correo@pawcare.com"}ngOnInit(){var n;this.vacunaForm=this.fb.group({nombre:["",[m.k0.required,m.k0.minLength(3),m.k0.pattern("^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1 ]+$")]],fechaHora:[(null===(n=this.vacuna)||void 0===n?void 0:n.fechayhora)||"",m.k0.required]});const t=localStorage.getItem("usuarioLogin");if(t){const e=JSON.parse(t);this.usuarioLogin=e.uid}}presentToast(n){var t=this;return(0,g.A)(function*(){(yield t.toastController.create({message:n,duration:1500,position:"bottom"})).present()})()}guardarVacuna(){var n=this;return(0,g.A)(function*(){if(n.vacunaForm.invalid)return void h().fire({icon:"warning",title:"Formulario inv\xe1lido",text:"Por favor completa todos los campos correctamente.",confirmButtonText:"OK",heightAuto:!1});const t=yield n.loadingController.create({message:"Cargando...",spinner:"circles"});yield t.present();const e=n.vacunaForm.value,i={nombre:e.nombre,fechayhora:e.fechaHora,mid:n.mid,uid:n.usuarioLogin||"desconocido",creadaEn:new Date,estado:"aplicada"};try{var u;let p="";null!==(u=n.vacuna)&&void 0!==u&&u.vid?(yield(0,f.mZ)((0,f.H9)(n.firestore,"vacunasMascotas",n.vacuna.vid),i),p=n.vacuna.vid):(p=(yield(0,f.gS)((0,f.rJ)(n.firestore,"vacunasMascotas"),i)).id,yield(0,f.mZ)((0,f.H9)(n.firestore,"vacunasMascotas",p),{vid:p})),yield t.dismiss(),h().fire({icon:"success",title:"Registro Exitoso",text:"Vacuna guardada correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>{n.modalCtrl.dismiss(!0)})}catch(p){yield t.dismiss(),console.error("\u{1f525} Error al guardar vacuna:",p),h().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al guardar la vacuna. Intenta nuevamente.",confirmButtonText:"OK",heightAuto:!1})}})()}exportarPDF(){const n=document.getElementById("historial-content");n?b()(n).then(t=>{const e=t.toDataURL("image/png"),i=new V.Ay("p","mm","a4"),u=i.getImageProperties(e),p=i.internal.pageSize.getWidth();i.addImage(e,"PNG",0,0,p,u.height*p/u.width),i.save("historial_pawcare.pdf")}):console.error("\u274c No se encontr\xf3 el contenedor del historial")}cerrar(){this.modalCtrl.dismiss(!1)}}return(o=c).\u0275fac=function(n){return new(n||o)(a.rXU(m.ok),a.rXU(f._7),a.rXU(r.K_),a.rXU(r.W3),a.rXU(E._),a.rXU(C.Xi))},o.\u0275cmp=a.VBU({type:o,selectors:[["app-modal-vacuna"]],inputs:{mid:"mid",vacuna:"vacuna"},decls:27,vars:6,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","nombre","type","text","required",""],["color","danger",4,"ngIf"],["formControlName","fechaHora","presentation","date-time","placeholder","Seleccionar fecha y hora","required",""],["expand","block","shape","round","size","large","type","submit","color","dark",1,"ion-margin-top",3,"disabled"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function(n,t){if(1&n&&(a.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),a.EFF(3),a.k0s(),a.j41(4,"ion-buttons",1)(5,"ion-button",2),a.bIt("click",function(){return t.cerrar()}),a.EFF(6,"Cerrar"),a.k0s()()()(),a.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),a.bIt("ngSubmit",function(){return t.guardarVacuna()}),a.j41(11,"ion-item",5)(12,"ion-label",6),a.EFF(13,"Nombre "),a.j41(14,"ion-text",7),a.EFF(15,"*"),a.k0s()(),a.nrm(16,"ion-input",8),a.k0s(),a.DNE(17,I,4,3,"ion-text",9),a.j41(18,"ion-item",5)(19,"ion-label",6),a.EFF(20,"Fecha y Hora de Aplicaci\xf3n "),a.j41(21,"ion-text",7),a.EFF(22,"*"),a.k0s()(),a.nrm(23,"ion-datetime",10),a.k0s(),a.DNE(24,k,3,0,"ion-text",9),a.j41(25,"ion-button",11),a.EFF(26),a.k0s()()()()()),2&n){let e,i;a.R7$(3),a.JRh(t.vacuna?"Editar Vacuna":"Nueva Vacuna"),a.R7$(7),a.Y8G("formGroup",t.vacunaForm),a.R7$(7),a.Y8G("ngIf",(null==(e=t.vacunaForm.get("nombre"))?null:e.touched)&&(null==(e=t.vacunaForm.get("nombre"))?null:e.invalid)),a.R7$(7),a.Y8G("ngIf",(null==(i=t.vacunaForm.get("fechaHora"))?null:i.touched)&&(null==(i=t.vacunaForm.get("fechaHora"))?null:i.hasError("required"))),a.R7$(),a.Y8G("disabled",t.vacunaForm.invalid),a.R7$(),a.SpI(" ",t.vacuna?"Actualizar Vacuna":"Guardar Vacuna"," ")}},dependencies:[v.MD,v.bT,r.bv,r.Jm,r.QW,r.b_,r.I9,r.W9,r.A9,r.eU,r.$w,r.uz,r.he,r.IO,r.BC,r.ai,r.Je,r.Gw,m.X1,m.qT,m.BC,m.cb,m.YS,m.j4,m.JD],styles:["ion-button[_ngcontent-%COMP%]{margin-top:12px;font-size:15px;letter-spacing:.5px;border-radius:12px}"]}),c})();var d=l(3273);let T=(()=>{var o;class c{constructor(n){this.firestore=n}obtenerVacunas(n){const t=(0,d.rJ)(this.firestore,"vacunasMascotas"),e=(0,d.P)(t,(0,d._M)("mid","==",n),(0,d.My)("fecha","desc"));return(0,f.xs)(e,{idField:"vid"})}obtenerVacunasporEstadp(n){const t=(0,d.rJ)(this.firestore,"vacunasMascotas"),e=(0,d.P)(t,(0,d._M)("mid","==",n),(0,d._M)("estado","==","aplicada"));return(0,f.xs)(e,{idField:"vid"})}agregarVacuna(n){var t=this;return(0,g.A)(function*(){const e=yield(0,d.gS)((0,d.rJ)(t.firestore,"vacunasMascotas"),n);yield(0,d.mZ)((0,d.H9)(t.firestore,"vacunasMascotas",e.id),{vid:e.id})})()}actualizarVacuna(n,t){var e=this;return(0,g.A)(function*(){const i=(0,d.H9)(e.firestore,"vacunasMascotas",n);yield(0,d.mZ)(i,t)})()}eliminarVacuna(n){var t=this;return(0,g.A)(function*(){yield(0,d.kd)((0,d.H9)(t.firestore,"vacunasMascotas",n))})()}}return(o=c).\u0275fac=function(n){return new(n||o)(a.KVO(f._7))},o.\u0275prov=a.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),c})();var D=l(5391);const $=(o,c)=>({"estado-aplicada":o,"estado-pendiente":c});function R(o,c){if(1&o){const s=a.RV6();a.j41(0,"ion-item",10),a.bIt("click",function(){const t=a.eBV(s).$implicit,e=a.XpG(2);return a.Njj(e.abrirModalVacuna(t))}),a.j41(1,"ion-label")(2,"h2",11),a.EFF(3),a.k0s(),a.j41(4,"p"),a.EFF(5),a.k0s(),a.j41(6,"p"),a.EFF(7," Estado: "),a.j41(8,"strong",12),a.EFF(9),a.nI1(10,"titlecase"),a.k0s()()(),a.j41(11,"ion-button",13),a.bIt("click",function(t){const e=a.eBV(s).$implicit;return a.XpG(2).eliminarVacuna(e.vid),a.Njj(t.stopPropagation())}),a.nrm(12,"ion-icon",14),a.k0s()()}if(2&o){const s=c.$implicit,n=a.XpG(2);a.R7$(3),a.JRh(s.nombre),a.R7$(2),a.SpI("\u{1f4c5} ",n.formatearFechaHora(s.fechayhora),""),a.R7$(3),a.Y8G("ngClass",a.l_i(6,$,"aplicada"===s.estado,"aplicada"!==s.estado)),a.R7$(),a.SpI(" ",a.bMT(10,4,s.estado)," ")}}function O(o,c){1&o&&(a.j41(0,"ion-item")(1,"ion-label",15),a.EFF(2,"No hay vacunas registradas."),a.k0s()())}function G(o,c){if(1&o&&(a.j41(0,"ion-list"),a.DNE(1,R,13,9,"ion-item",8)(2,O,3,0,"ion-item",9),a.k0s()),2&o){const s=c.ngIf;a.R7$(),a.Y8G("ngForOf",s),a.R7$(),a.Y8G("ngIf",0===s.length)}}function N(o,c){1&o&&(a.j41(0,"div",16),a.nrm(1,"ion-spinner",17),a.j41(2,"p",15),a.EFF(3,"Cargando vacunas..."),a.k0s()())}let A=(()=>{var o;class c{constructor(n,t,e,i,u){this.vacunaService=n,this.modalController=t,this.alertController=e,this.exportarpdf=i,this.loadingController=u,this.vacunas=[]}ngOnInit(){const n=localStorage.getItem("mascotaSeleccionada");n&&(this.mascotaSeleccionada=JSON.parse(n),this.cargarVacunas())}cargarVacunas(){this.vacunas$=this.vacunaService.obtenerVacunasporEstadp(this.mascotaSeleccionada.mid),this.vacunas$.subscribe(n=>{this.vacunas=n||[]})}abrirModalVacuna(n){var t=this;return(0,g.A)(function*(){const e=yield t.modalController.create({component:P,componentProps:{vacuna:n,mid:t.mascotaSeleccionada.mid}});e.onDidDismiss().then(i=>{i.data&&t.cargarVacunas()}),yield e.present()})()}eliminarVacuna(n){var t=this;return(0,g.A)(function*(){var i;yield(yield t.alertController.create({header:"Eliminar Vacuna",message:"\xbfEst\xe1s seguro de eliminar esta vacuna?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(i=(0,g.A)(function*(){const u=yield t.loadingController.create({message:"Eliminando...",spinner:"circles"});yield u.present();try{yield t.vacunaService.eliminarVacuna(n),t.cargarVacunas(),yield u.dismiss(),h().fire({icon:"success",title:"Eliminaci\xf3n Exitosa",text:"La vacuna ha sido eliminada correctamente.",confirmButtonText:"OK",heightAuto:!1})}catch{yield u.dismiss(),h().fire({icon:"error",title:"Error al eliminar",text:"Ocurri\xf3 un error al eliminar la vacuna.",confirmButtonText:"OK",heightAuto:!1})}}),function(){return i.apply(this,arguments)})}]})).present()})()}formatearFechaHora(n){if(!n)return"N/A";const t=new Date(n);return`${t.toLocaleDateString("es-PE")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}exportarPDF(){var n;this.vacunas&&0!==this.vacunas.length?this.exportarpdf.exportarVacunas(this.vacunas,null===(n=this.mascotaSeleccionada)||void 0===n?void 0:n.nombre,this.formatearFechaHora):h().fire({icon:"warning",title:"Sin Historial",text:"No hay vacunas registradas para exportar.",confirmButtonText:"OK",heightAuto:!1})}}return(o=c).\u0275fac=function(n){return new(n||o)(a.rXU(T),a.rXU(r.W3),a.rXU(r.hG),a.rXU(D.n),a.rXU(r.Xi))},o.\u0275cmp=a.VBU({type:o,selectors:[["app-vacunas"]],decls:15,vars:4,consts:[["cargando",""],["color","tertiary"],["slot","end"],[3,"click"],["name","download-outline","slot","start"],["name","add","slot","icon-only"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["lines","inset","button","","class","vacuna-item",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["lines","inset","button","",1,"vacuna-item",3,"click"],[1,"titulo"],[3,"ngClass"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash"],[1,"ion-text-center"],[1,"cargando-spinner"],["name","crescent"]],template:function(n,t){if(1&n){const e=a.RV6();a.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),a.EFF(3,"Vacunas"),a.k0s(),a.j41(4,"ion-buttons",2)(5,"ion-button",3),a.bIt("click",function(){return a.eBV(e),a.Njj(t.exportarPDF())}),a.nrm(6,"ion-icon",4),a.EFF(7," Exportar PDF "),a.k0s(),a.j41(8,"ion-button",3),a.bIt("click",function(){return a.eBV(e),a.Njj(t.abrirModalVacuna())}),a.nrm(9,"ion-icon",5),a.k0s()()()(),a.j41(10,"ion-content",6),a.DNE(11,G,3,2,"ion-list",7),a.nI1(12,"async"),a.DNE(13,N,4,0,"ng-template",null,0,a.C5r),a.k0s()}if(2&n){const e=a.sdS(14);a.R7$(11),a.Y8G("ngIf",a.bMT(12,2,t.vacunas$))("ngIfElse",e)}},dependencies:[v.MD,v.YU,v.Sq,v.bT,v.Jj,v.PV,r.bv,r.Jm,r.QW,r.W9,r.eU,r.iq,r.uz,r.he,r.nf,r.w2,r.BC,r.ai,m.YN],styles:[".cargando-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center}.vacuna-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 8px;border-radius:12px;margin-bottom:10px;background:#f9f9f9;box-shadow:0 1px 4px #0000000d}.titulo[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;margin-bottom:4px}.estado-aplicada[_ngcontent-%COMP%]{color:green}.estado-pendiente[_ngcontent-%COMP%]{color:red}.cargando-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:50px;color:#666}"]}),c})()}}]);