"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6590],{6590:(J,A,d)=>{d.r(A),d.d(A,{RegalimentacionPage:()=>H});var p=d(467),g=d(2881),c=d(9417),i=d(3092),u=d(3273),b=d(8032),f=d.n(b),n=d(1360),k=d(9967),x=d(9506);function j(o,r){1&o&&(n.j41(0,"ion-text",7)(1,"p",27),n.EFF(2,"La fecha es obligatoria."),n.k0s()())}function v(o,r){1&o&&(n.j41(0,"ion-text",7)(1,"p",27),n.EFF(2,"El tipo de alimento es obligatorio."),n.k0s()())}function C(o,r){1&o&&(n.j41(0,"p",27),n.EFF(1,"Este campo es obligatorio."),n.k0s())}function R(o,r){1&o&&(n.j41(0,"p",27),n.EFF(1,"Solo letras y espacios permitidos."),n.k0s())}function I(o,r){1&o&&(n.j41(0,"p",27),n.EFF(1,"Debe tener al menos 3 caracteres."),n.k0s())}function y(o,r){if(1&o&&(n.j41(0,"ion-text",7),n.DNE(1,C,2,0,"p",28)(2,R,2,0,"p",28)(3,I,2,0,"p",28),n.k0s()),2&o){let l,t,e;const a=n.XpG();n.R7$(),n.Y8G("ngIf",null==(l=a.alimentacionForm.get("nombreAlimento"))?null:l.hasError("required")),n.R7$(),n.Y8G("ngIf",null==(t=a.alimentacionForm.get("nombreAlimento"))?null:t.hasError("pattern")),n.R7$(),n.Y8G("ngIf",null==(e=a.alimentacionForm.get("nombreAlimento"))?null:e.hasError("minlength"))}}function S(o,r){1&o&&(n.j41(0,"p",27),n.EFF(1,"La cantidad es obligatoria."),n.k0s())}function M(o,r){1&o&&(n.j41(0,"p",27),n.EFF(1,"Solo n\xfameros, decimales y unidades (g, kg)."),n.k0s())}function T(o,r){if(1&o&&(n.j41(0,"ion-text",7),n.DNE(1,S,2,0,"p",28)(2,M,2,0,"p",28),n.k0s()),2&o){let l,t;const e=n.XpG();n.R7$(),n.Y8G("ngIf",null==(l=e.alimentacionForm.get("cantidad"))?null:l.hasError("required")),n.R7$(),n.Y8G("ngIf",null==(t=e.alimentacionForm.get("cantidad"))?null:t.hasError("pattern"))}}function $(o,r){1&o&&(n.j41(0,"ion-text",7)(1,"p",27),n.EFF(2,"El m\xe9todo es obligatorio."),n.k0s()())}function D(o,r){1&o&&(n.j41(0,"ion-text",7)(1,"p",27),n.EFF(2,"Este campo es obligatorio."),n.k0s()())}function N(o,r){1&o&&(n.j41(0,"p",27),n.EFF(1,"Debe tener al menos 3 caracteres."),n.k0s())}function G(o,r){if(1&o&&(n.j41(0,"ion-text",7),n.DNE(1,N,2,0,"p",28),n.k0s()),2&o){let l;const t=n.XpG();n.R7$(),n.Y8G("ngIf",null==(l=t.alimentacionForm.get("obsAdicionales"))?null:l.hasError("minlength"))}}let P=(()=>{var o;class r{constructor(t,e,a,s,m){this.fb=t,this.firestore=e,this.modalController=a,this.toastController=s,this.loadingController=m,this.hoy=(new Date).toISOString(),this.alimentacionForm=this.fb.group({fecha:[this.hoy,c.k0.required],tipoAlimento:["",c.k0.required],nombreAlimento:["",[c.k0.required,c.k0.minLength(3),c.k0.pattern("^[a-zA-Z\xc1\xc9\xcd\xd3\xda\xe1\xe9\xed\xf3\xfa\xf1\xd1 ]+$")]],cantidad:["",[c.k0.required,c.k0.pattern("^[0-9]+([.,][0-9]+)?\\s?(g|kg)?$")]],metodo:["",c.k0.required],comio:["true",c.k0.required],obsAdicionales:["",c.k0.minLength(3)]})}ngOnInit(){this.alimentacion&&this.alimentacionForm.patchValue(this.alimentacion)}guardarAlimentacion(){var t=this;return(0,p.A)(function*(){if(t.alimentacionForm.invalid)return void f().fire({icon:"warning",title:"Formulario inv\xe1lido",text:"Por favor completa todos los campos correctamente.",confirmButtonText:"OK",heightAuto:!1});const e=yield t.loadingController.create({message:"Cargando...",spinner:"crescent",backdropDismiss:!1});yield e.present();const a={...t.alimentacionForm.value,mid:t.mid,comio:"true"===t.alimentacionForm.value.comio,creadaEn:new Date};try{var s;if(null!==(s=t.alimentacion)&&void 0!==s&&s.aid)yield(0,u.mZ)((0,u.H9)(t.firestore,"alimentacionMascotas",t.alimentacion.aid),a);else{const m=yield(0,u.gS)((0,u.rJ)(t.firestore,"alimentacionMascotas"),a);yield(0,u.mZ)((0,u.H9)(t.firestore,"alimentacionMascotas",m.id),{aid:m.id})}yield e.dismiss(),f().fire({icon:"success",title:"Registro exitoso",text:"Registro de alimentaci\xf3n guardado correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>{t.modalController.dismiss(!0)})}catch(m){console.error("\u{1f525} Error al guardar registro:",m),yield e.dismiss(),f().fire({icon:"error",title:"Error",text:"Hubo un error al guardar el registro. Int\xe9ntalo nuevamente.",confirmButtonText:"OK",heightAuto:!1})}})()}cerrar(){this.modalController.dismiss(!1)}presentToast(t){var e=this;return(0,p.A)(function*(){(yield e.toastController.create({message:t,duration:2e3,color:"success"})).present()})()}}return(o=r).\u0275fac=function(t){return new(t||o)(n.rXU(c.ok),n.rXU(k._7),n.rXU(i.W3),n.rXU(x.K_),n.rXU(i.Xi))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-modal-alimentacion"]],inputs:{alimentacion:"alimentacion",mid:"mid"},decls:84,vars:11,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","fecha","presentation","date",3,"max"],["color","danger",4,"ngIf"],["formControlName","tipoAlimento","placeholder","Seleccionar..."],["value","Fruta"],["value","Insectos"],["value","Verdura"],["value","Otro"],["formControlName","nombreAlimento"],["formControlName","cantidad","type","text"],["formControlName","metodo","placeholder","Seleccionar..."],["value","Manual"],["value","Autom\xe1tica"],["value","Forzada"],["formControlName","comio"],["lines","none"],["value","true","slot","start"],["value","false","slot","start"],["formControlName","obsAdicionales"],["expand","block","shape","round","size","large","type","submit","color","dark",1,"ion-margin-top"],[1,"ion-padding-start"],["class","ion-padding-start",4,"ngIf"]],template:function(t,e){if(1&t&&(n.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),n.EFF(3),n.k0s(),n.j41(4,"ion-buttons",1)(5,"ion-button",2),n.bIt("click",function(){return e.cerrar()}),n.EFF(6,"Cerrar"),n.k0s()()()(),n.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),n.bIt("ngSubmit",function(){return e.guardarAlimentacion()}),n.j41(11,"ion-item",5)(12,"ion-label",6),n.EFF(13,"Fecha "),n.j41(14,"ion-text",7),n.EFF(15,"*"),n.k0s()(),n.nrm(16,"ion-datetime",8),n.k0s(),n.DNE(17,j,3,0,"ion-text",9),n.j41(18,"ion-item",5)(19,"ion-label"),n.EFF(20,"Tipo de alimento "),n.j41(21,"ion-text",7),n.EFF(22,"*"),n.k0s()(),n.j41(23,"ion-select",10)(24,"ion-select-option",11),n.EFF(25,"Fruta"),n.k0s(),n.j41(26,"ion-select-option",12),n.EFF(27,"Insectos"),n.k0s(),n.j41(28,"ion-select-option",13),n.EFF(29,"Verdura"),n.k0s(),n.j41(30,"ion-select-option",14),n.EFF(31,"Otro"),n.k0s()()(),n.DNE(32,v,3,0,"ion-text",9),n.j41(33,"ion-item",5)(34,"ion-label",6),n.EFF(35,"Nombre del alimento "),n.j41(36,"ion-text",7),n.EFF(37,"*"),n.k0s()(),n.nrm(38,"ion-input",15),n.k0s(),n.DNE(39,y,4,3,"ion-text",9),n.j41(40,"ion-item",5)(41,"ion-label",6),n.EFF(42,"Cantidad ofrecida (ej: 100g, 0.5kg) "),n.j41(43,"ion-text",7),n.EFF(44,"*"),n.k0s()(),n.nrm(45,"ion-input",16),n.k0s(),n.DNE(46,T,3,2,"ion-text",9),n.j41(47,"ion-item",5)(48,"ion-label"),n.EFF(49,"M\xe9todo "),n.j41(50,"ion-text",7),n.EFF(51,"*"),n.k0s()(),n.j41(52,"ion-select",17)(53,"ion-select-option",18),n.EFF(54,"Manual"),n.k0s(),n.j41(55,"ion-select-option",19),n.EFF(56,"Autom\xe1tica"),n.k0s(),n.j41(57,"ion-select-option",20),n.EFF(58,"Forzada"),n.k0s()()(),n.DNE(59,$,3,0,"ion-text",9),n.j41(60,"ion-item",5)(61,"ion-label"),n.EFF(62,"\xbfComi\xf3? "),n.j41(63,"ion-text",7),n.EFF(64,"*"),n.k0s()()(),n.j41(65,"ion-radio-group",21)(66,"ion-item",22)(67,"ion-label"),n.EFF(68,"S\xed"),n.k0s(),n.nrm(69,"ion-radio",23),n.k0s(),n.j41(70,"ion-item",22)(71,"ion-label"),n.EFF(72,"No"),n.k0s(),n.nrm(73,"ion-radio",24),n.k0s()(),n.DNE(74,D,3,0,"ion-text",9),n.j41(75,"ion-item",5)(76,"ion-label",6),n.EFF(77,"Observaciones "),n.j41(78,"ion-text",7),n.EFF(79,"*"),n.k0s()(),n.nrm(80,"ion-textarea",25),n.k0s(),n.DNE(81,G,2,1,"ion-text",9),n.j41(82,"ion-button",26),n.EFF(83),n.k0s()()()()()),2&t){let a,s,m,F,_,h,E;n.R7$(3),n.JRh(e.alimentacion?"Editar Registro":"Nuevo Registro"),n.R7$(7),n.Y8G("formGroup",e.alimentacionForm),n.R7$(6),n.Y8G("max",e.hoy),n.R7$(),n.Y8G("ngIf",(null==(a=e.alimentacionForm.get("fecha"))?null:a.hasError("required"))&&(null==(a=e.alimentacionForm.get("fecha"))?null:a.touched)),n.R7$(15),n.Y8G("ngIf",(null==(s=e.alimentacionForm.get("tipoAlimento"))?null:s.hasError("required"))&&(null==(s=e.alimentacionForm.get("tipoAlimento"))?null:s.touched)),n.R7$(7),n.Y8G("ngIf",null==(m=e.alimentacionForm.get("nombreAlimento"))?null:m.touched),n.R7$(7),n.Y8G("ngIf",null==(F=e.alimentacionForm.get("cantidad"))?null:F.touched),n.R7$(13),n.Y8G("ngIf",(null==(_=e.alimentacionForm.get("metodo"))?null:_.hasError("required"))&&(null==(_=e.alimentacionForm.get("metodo"))?null:_.touched)),n.R7$(15),n.Y8G("ngIf",(null==(h=e.alimentacionForm.get("comio"))?null:h.hasError("required"))&&(null==(h=e.alimentacionForm.get("comio"))?null:h.touched)),n.R7$(7),n.Y8G("ngIf",(null==(E=e.alimentacionForm.get("obsAdicionales"))?null:E.touched)&&(null==(E=e.alimentacionForm.get("obsAdicionales"))?null:E.value)),n.R7$(2),n.SpI(" ",e.alimentacion?"Actualizar":"Guardar"," Registro ")}},dependencies:[g.MD,g.bT,i.bv,i.Jm,i.QW,i.b_,i.I9,i.W9,i.A9,i.eU,i.$w,i.uz,i.he,i.KO,i.f0,i.Nm,i.Ip,i.IO,i.nc,i.BC,i.ai,i.Je,i.Gw,c.X1,c.qT,c.BC,c.cb,c.j4,c.JD],styles:["ion-button[_ngcontent-%COMP%]{margin-top:12px;font-size:15px;letter-spacing:.5px;border-radius:12px}"]}),r})(),O=(()=>{var o;class r{constructor(t){this.firestore=t}obtenerAlimentacion(t){const e=(0,u.rJ)(this.firestore,"alimentacionMascotas"),a=(0,u.P)(e,(0,u._M)("mid","==",t),(0,u.My)("fecha","desc"));return(0,k.xs)(a,{idField:"aid"})}eliminarAlimentacion(t){var e=this;return(0,p.A)(function*(){yield(0,u.kd)((0,u.H9)(e.firestore,"alimentacionMascotas",t))})()}}return(o=r).\u0275fac=function(t){return new(t||o)(n.KVO(k._7))},o.\u0275prov=n.jDH({token:o,factory:o.\u0275fac,providedIn:"root"}),r})();var X=d(5391);function Y(o,r){if(1&o){const l=n.RV6();n.j41(0,"ion-item",10),n.bIt("click",function(){const e=n.eBV(l).$implicit,a=n.XpG(2);return n.Njj(a.abrirModalAlimentacion(e))}),n.j41(1,"ion-label")(2,"h2"),n.EFF(3),n.k0s(),n.j41(4,"p"),n.EFF(5),n.k0s(),n.j41(6,"p")(7,"strong"),n.EFF(8,"Cantidad:"),n.k0s(),n.EFF(9),n.k0s(),n.j41(10,"p")(11,"strong"),n.EFF(12,"M\xe9todo:"),n.k0s(),n.EFF(13),n.k0s(),n.j41(14,"p")(15,"strong"),n.EFF(16,"\xbfComi\xf3?:"),n.k0s(),n.EFF(17),n.k0s(),n.j41(18,"p")(19,"strong"),n.EFF(20,"Observaciones:"),n.k0s(),n.EFF(21),n.k0s()(),n.j41(22,"ion-button",11),n.bIt("click",function(e){const a=n.eBV(l).$implicit;return n.XpG(2).eliminarAlimentacion(a.aid),n.Njj(e.stopPropagation())}),n.nrm(23,"ion-icon",12),n.k0s()()}if(2&o){const l=r.$implicit,t=n.XpG(2);n.R7$(3),n.Lme("",l.tipoAlimento," - ",l.nombreAlimento,""),n.R7$(2),n.SpI("\u{1f4c5} ",t.formatearFechaHora(l.fecha),""),n.R7$(4),n.SpI(" ",l.cantidad,""),n.R7$(4),n.SpI(" ",l.metodo,""),n.R7$(4),n.SpI(" ",l.comio?"S\xed":"No",""),n.R7$(4),n.SpI(" ",l.obsAdicionales||"Ninguna","")}}function B(o,r){1&o&&(n.j41(0,"ion-item")(1,"ion-label",13),n.EFF(2,"No hay registros de alimentaci\xf3n."),n.k0s()())}function U(o,r){if(1&o&&(n.j41(0,"ion-list"),n.DNE(1,Y,24,7,"ion-item",8)(2,B,3,0,"ion-item",9),n.k0s()),2&o){const l=r.ngIf;n.R7$(),n.Y8G("ngForOf",l),n.R7$(),n.Y8G("ngIf",0===l.length)}}function V(o,r){1&o&&(n.j41(0,"div",14),n.nrm(1,"ion-spinner",15),n.j41(2,"p",13),n.EFF(3,"Cargando historial de alimentaci\xf3n..."),n.k0s()())}let H=(()=>{var o;class r{constructor(t,e,a,s,m){this.alimentacionService=t,this.modalController=e,this.alertController=a,this.exportarpdf=s,this.loadingController=m,this.alimentaciones=[]}ngOnInit(){const t=localStorage.getItem("mascotaSeleccionada");t&&(this.mascotaSeleccionada=JSON.parse(t),this.cargarAlimentacion())}cargarAlimentacion(){this.alimentaciones$=this.alimentacionService.obtenerAlimentacion(this.mascotaSeleccionada.mid),this.alimentaciones$.subscribe(t=>this.alimentaciones=t||[])}abrirModalAlimentacion(t){var e=this;return(0,p.A)(function*(){const a=yield e.modalController.create({component:P,componentProps:{alimentacion:t,mid:e.mascotaSeleccionada.mid}});a.onDidDismiss().then(s=>{s.data&&e.cargarAlimentacion()}),yield a.present()})()}eliminarAlimentacion(t){var e=this;return(0,p.A)(function*(){var s;yield(yield e.alertController.create({header:"Eliminar Registro",message:"\xbfDeseas eliminar este registro de alimentaci\xf3n?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(s=(0,p.A)(function*(){const m=yield e.loadingController.create({message:"Eliminando...",spinner:"circles"});yield m.present();try{yield e.alimentacionService.eliminarAlimentacion(t),yield m.dismiss(),f().fire({icon:"success",title:"Eliminado",text:"Registro eliminado exitosamente.",confirmButtonText:"OK",heightAuto:!1}),e.cargarAlimentacion()}catch(F){yield m.dismiss(),f().fire({icon:"error",title:"Error",text:"No se pudo eliminar el registro.",confirmButtonText:"OK",heightAuto:!1}),console.error("Error eliminando registro:",F)}}),function(){return s.apply(this,arguments)})}]})).present()})()}formatearFechaHora(t){if(!t)return"N/A";const e=new Date(t);return`${e.toLocaleDateString("es-CL")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`}exportarPDF(){var t;0!==this.alimentaciones.length?this.exportarpdf.exportarAlimentacion(this.alimentaciones,null===(t=this.mascotaSeleccionada)||void 0===t?void 0:t.nombre,this.formatearFechaHora):f().fire({icon:"info",title:"Sin historial",text:"No hay registros de alimentaci\xf3n para exportar.",confirmButtonText:"OK",heightAuto:!1})}}return(o=r).\u0275fac=function(t){return new(t||o)(n.rXU(O),n.rXU(i.W3),n.rXU(i.hG),n.rXU(X.n),n.rXU(x.Xi))},o.\u0275cmp=n.VBU({type:o,selectors:[["app-regalimentacion"]],decls:15,vars:4,consts:[["cargando",""],["color","tertiary"],["slot","end"],[3,"click"],["name","download-outline","slot","start"],["name","add","slot","icon-only"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["lines","inset","button","",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["lines","inset","button","",3,"click"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash"],[1,"ion-text-center"],[1,"cargando-spinner"],["name","crescent"]],template:function(t,e){if(1&t){const a=n.RV6();n.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),n.EFF(3,"Alimentaci\xf3n"),n.k0s(),n.j41(4,"ion-buttons",2)(5,"ion-button",3),n.bIt("click",function(){return n.eBV(a),n.Njj(e.exportarPDF())}),n.nrm(6,"ion-icon",4),n.EFF(7," Exportar PDF "),n.k0s(),n.j41(8,"ion-button",3),n.bIt("click",function(){return n.eBV(a),n.Njj(e.abrirModalAlimentacion())}),n.nrm(9,"ion-icon",5),n.k0s()()()(),n.j41(10,"ion-content",6),n.DNE(11,U,3,2,"ion-list",7),n.nI1(12,"async"),n.DNE(13,V,4,0,"ng-template",null,0,n.C5r),n.k0s()}if(2&t){const a=n.sdS(14);n.R7$(11),n.Y8G("ngIf",n.bMT(12,2,e.alimentaciones$))("ngIfElse",a)}},dependencies:[g.MD,g.Sq,g.bT,g.Jj,i.bv,i.Jm,i.QW,i.W9,i.eU,i.iq,i.uz,i.he,i.nf,i.w2,i.BC,i.ai,c.YN],styles:[".cargando-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center}"]}),r})()}}]);