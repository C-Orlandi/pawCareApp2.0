"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8600],{8600:(G,_,p)=>{p.r(_),p.d(_,{DesparasitacionPage:()=>R});var f=p(467),g=p(2881),m=p(9417),o=p(3092),r=p(9967),F=p(8032),h=p.n(F),a=p(1360),b=p(1334),D=p(9506);function v(n,l){1&n&&(a.j41(0,"p",13),a.EFF(1,"El nombre es obligatorio."),a.k0s())}function x(n,l){1&n&&(a.j41(0,"p",13),a.EFF(1,"Debe tener al menos 3 letras."),a.k0s())}function y(n,l){1&n&&(a.j41(0,"p",13),a.EFF(1,"Solo se permiten letras."),a.k0s())}function C(n,l){if(1&n&&(a.j41(0,"ion-text",7),a.DNE(1,v,2,0,"p",12)(2,x,2,0,"p",12)(3,y,2,0,"p",12),a.k0s()),2&n){let s,e,t;const i=a.XpG();a.R7$(),a.Y8G("ngIf",null==(s=i.desparasitacionForm.get("nombre"))||null==s.errors?null:s.errors.required),a.R7$(),a.Y8G("ngIf",null==(e=i.desparasitacionForm.get("nombre"))||null==e.errors?null:e.errors.minlength),a.R7$(),a.Y8G("ngIf",null==(t=i.desparasitacionForm.get("nombre"))||null==t.errors?null:t.errors.pattern)}}function E(n,l){1&n&&(a.j41(0,"ion-text",7)(1,"p",13),a.EFF(2,"Selecciona una fecha y hora v\xe1lida."),a.k0s()())}let k=(()=>{var n;class l{constructor(e,t,i,c,d,u){this.fb=e,this.firestore=t,this.toastController=i,this.modalCtrl=c,this.emailService=d,this.loadingController=u}ngOnInit(){this.desparasitacionForm=this.fb.group({nombre:["",[m.k0.required,m.k0.minLength(3),m.k0.pattern("^[a-zA-Z\xe1\xe9\xed\xf3\xfa\xc1\xc9\xcd\xd3\xda\xf1\xd1 ]+$")]],fechaHora:["",m.k0.required]});const e=localStorage.getItem("usuarioLogin");if(e){const t=JSON.parse(e);this.usuarioLogin=t.uid}}presentToast(e){var t=this;return(0,f.A)(function*(){(yield t.toastController.create({message:e,duration:1500,position:"bottom"})).present()})()}guardarDesparasitacion(){var e=this;return(0,f.A)(function*(){if(e.desparasitacionForm.invalid||!e.mid)return void h().fire({icon:"warning",title:"Formulario inv\xe1lido",text:"Por favor completa todos los campos correctamente.",confirmButtonText:"OK",heightAuto:!1});const t=yield e.loadingController.create({message:"Guardando...",spinner:"circles"});yield t.present();const i=e.desparasitacionForm.value,c={nombre:i.nombre,fechayhora:i.fechaHora,mid:e.mid,uid:e.usuarioLogin||"desconocido",creadaEn:new Date,estado:"aplicada"};try{var d;let u="";null!==(d=e.desparasitacion)&&void 0!==d&&d.id_desp?(yield(0,r.mZ)((0,r.H9)(e.firestore,"desparasitacionesMascotas",e.desparasitacion.id_desp),c),u=e.desparasitacion.id_desp):(u=(yield(0,r.gS)((0,r.rJ)(e.firestore,"desparasitacionesMascotas"),c)).id,yield(0,r.mZ)((0,r.H9)(e.firestore,"desparasitacionesMascotas",u),{id_desp:u})),yield t.dismiss(),h().fire({icon:"success",title:"Registro Exitoso",text:"La desparasitaci\xf3n fue guardada correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>{e.modalCtrl.dismiss(!0)})}catch(u){yield t.dismiss(),console.error("Error al guardar la desparasitaci\xf3n:",u),h().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al guardar la desparasitaci\xf3n.",confirmButtonText:"OK",heightAuto:!1})}})()}cerrar(){this.modalCtrl.dismiss(!1)}}return(n=l).\u0275fac=function(e){return new(e||n)(a.rXU(m.ok),a.rXU(r._7),a.rXU(o.K_),a.rXU(o.W3),a.rXU(b._),a.rXU(D.Xi))},n.\u0275cmp=a.VBU({type:n,selectors:[["app-modal-desparasitacion"]],inputs:{mid:"mid",desparasitacion:"desparasitacion"},decls:27,vars:6,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","nombre","type","text","required",""],["color","danger",4,"ngIf"],["formControlName","fechaHora","presentation","date-time","placeholder","Seleccionar fecha y hora","required",""],["expand","block","shape","round","size","large","type","submit","color","dark",1,"ion-margin-top",3,"disabled"],["class","ion-padding-start",4,"ngIf"],[1,"ion-padding-start"]],template:function(e,t){if(1&e&&(a.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),a.EFF(3),a.k0s(),a.j41(4,"ion-buttons",1)(5,"ion-button",2),a.bIt("click",function(){return t.cerrar()}),a.EFF(6,"Cerrar"),a.k0s()()()(),a.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),a.bIt("ngSubmit",function(){return t.guardarDesparasitacion()}),a.j41(11,"ion-item",5)(12,"ion-label",6),a.EFF(13,"Nombre "),a.j41(14,"ion-text",7),a.EFF(15,"*"),a.k0s()(),a.nrm(16,"ion-input",8),a.k0s(),a.DNE(17,C,4,3,"ion-text",9),a.j41(18,"ion-item",5)(19,"ion-label",6),a.EFF(20,"Fecha y Hora de Aplicaci\xf3n "),a.j41(21,"ion-text",7),a.EFF(22,"*"),a.k0s()(),a.nrm(23,"ion-datetime",10),a.k0s(),a.DNE(24,E,3,0,"ion-text",9),a.j41(25,"ion-button",11),a.EFF(26),a.k0s()()()()()),2&e){let i,c;a.R7$(3),a.JRh(t.desparasitacion?"Editar Desparasitaci\xf3n":"Nueva Desparasitaci\xf3n"),a.R7$(7),a.Y8G("formGroup",t.desparasitacionForm),a.R7$(7),a.Y8G("ngIf",(null==(i=t.desparasitacionForm.get("nombre"))?null:i.touched)&&(null==(i=t.desparasitacionForm.get("nombre"))?null:i.invalid)),a.R7$(7),a.Y8G("ngIf",(null==(c=t.desparasitacionForm.get("fechaHora"))?null:c.touched)&&(null==(c=t.desparasitacionForm.get("fechaHora"))?null:c.invalid)),a.R7$(),a.Y8G("disabled",t.desparasitacionForm.invalid),a.R7$(),a.SpI(" ",t.desparasitacion?"Actualizar":"Guardar"," ")}},dependencies:[g.MD,g.bT,o.bv,o.Jm,o.QW,o.b_,o.I9,o.W9,o.A9,o.eU,o.$w,o.uz,o.he,o.IO,o.BC,o.ai,o.Je,o.Gw,m.X1,m.qT,m.BC,m.cb,m.YS,m.j4,m.JD],styles:["ion-button[_ngcontent-%COMP%]{margin-top:12px;font-size:15px;letter-spacing:.5px;border-radius:12px}"]}),l})(),M=(()=>{var n;class l{constructor(e){this.firestore=e}obtenerDesparasitaciones(e){const t=(0,r.rJ)(this.firestore,"desparasitacionesMascotas"),i=(0,r.P)(t,(0,r._M)("mid","==",e),(0,r.My)("fecha","desc"));return(0,r.xs)(i,{idField:"did"})}obtenerDesparasitacionesPorEstado(e){const t=(0,r.rJ)(this.firestore,"desparasitacionesMascotas"),i=(0,r.P)(t,(0,r._M)("mid","==",e),(0,r._M)("estado","==","aplicada"));return(0,r.xs)(i,{idField:"did"})}agregarDesparasitacion(e){var t=this;return(0,f.A)(function*(){const i=yield(0,r.gS)((0,r.rJ)(t.firestore,"desparasitacionesMascotas"),e);yield(0,r.mZ)((0,r.H9)(t.firestore,"desparasitacionesMascotas",i.id),{did:i.id})})()}actualizarDesparasitacion(e,t){var i=this;return(0,f.A)(function*(){const c=(0,r.H9)(i.firestore,"desparasitacionesMascotas",e);yield(0,r.mZ)(c,t)})()}eliminarDesparasitacion(e){var t=this;return(0,f.A)(function*(){yield(0,r.kd)((0,r.H9)(t.firestore,"desparasitacionesMascotas",e))})()}}return(n=l).\u0275fac=function(e){return new(e||n)(a.KVO(r._7))},n.\u0275prov=a.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),l})();var j=p(5391);const S=(n,l)=>({"estado-aplicada":n,"estado-pendiente":l});function P(n,l){if(1&n){const s=a.RV6();a.j41(0,"ion-item",10),a.bIt("click",function(){const t=a.eBV(s).$implicit,i=a.XpG(2);return a.Njj(i.abrirModalDesparasitacion(t))}),a.j41(1,"ion-label")(2,"h2",11),a.EFF(3),a.k0s(),a.j41(4,"p"),a.EFF(5),a.k0s(),a.j41(6,"p"),a.EFF(7," Estado: "),a.j41(8,"strong",12),a.EFF(9),a.nI1(10,"titlecase"),a.k0s()()(),a.j41(11,"ion-button",13),a.bIt("click",function(t){const i=a.eBV(s).$implicit;return a.XpG(2).eliminarDesparasitacion(i.did),a.Njj(t.stopPropagation())}),a.nrm(12,"ion-icon",14),a.k0s()()}if(2&n){const s=l.$implicit,e=a.XpG(2);a.R7$(3),a.JRh(s.nombre),a.R7$(2),a.SpI("\u{1f4c5} ",e.formatearFechaHora(s.fechayhora),""),a.R7$(3),a.Y8G("ngClass",a.l_i(6,S,"aplicada"===s.estado,"aplicada"!==s.estado)),a.R7$(),a.SpI(" ",a.bMT(10,4,s.estado)," ")}}function I(n,l){1&n&&(a.j41(0,"ion-item")(1,"ion-label",15),a.EFF(2,"No hay registros de desparasitaci\xf3n."),a.k0s()())}function T(n,l){if(1&n&&(a.j41(0,"ion-list"),a.DNE(1,P,13,9,"ion-item",8)(2,I,3,0,"ion-item",9),a.k0s()),2&n){const s=l.ngIf;a.R7$(),a.Y8G("ngForOf",s),a.R7$(),a.Y8G("ngIf",0===s.length)}}function $(n,l){1&n&&(a.j41(0,"div",16),a.nrm(1,"ion-spinner",17),a.j41(2,"p",15),a.EFF(3,"Cargando desparasitaciones..."),a.k0s()())}let R=(()=>{var n;class l{constructor(e,t,i,c,d){this.desparasitacionService=e,this.modalController=t,this.alertController=i,this.exportarpdf=c,this.loadingController=d,this.desparasitaciones=[]}ngOnInit(){const e=localStorage.getItem("mascotaSeleccionada");e&&(this.mascotaSeleccionada=JSON.parse(e),this.cargarDesparasitaciones())}cargarDesparasitaciones(){this.desparasitaciones$=this.desparasitacionService.obtenerDesparasitacionesPorEstado(this.mascotaSeleccionada.mid),this.desparasitaciones$.subscribe(e=>{this.desparasitaciones=e||[]})}abrirModalDesparasitacion(e){var t=this;return(0,f.A)(function*(){const i=yield t.modalController.create({component:k,componentProps:{desparasitacion:e,mid:t.mascotaSeleccionada.mid}});i.onDidDismiss().then(c=>{c.data&&t.cargarDesparasitaciones()}),yield i.present()})()}eliminarDesparasitacion(e){var t=this;return(0,f.A)(function*(){var c;yield(yield t.alertController.create({header:"Eliminar Desparasitaci\xf3n",message:"\xbfEst\xe1s seguro de eliminar este registro?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(c=(0,f.A)(function*(){const d=yield t.loadingController.create({message:"Eliminando...",spinner:"crescent"});yield d.present();try{yield t.desparasitacionService.eliminarDesparasitacion(e),yield d.dismiss(),t.cargarDesparasitaciones(),h().fire({icon:"success",title:"Registro eliminado",text:"La desparasitaci\xf3n fue eliminada exitosamente.",confirmButtonText:"OK",heightAuto:!1})}catch(u){console.error("Error al eliminar desparasitaci\xf3n:",u),yield d.dismiss(),h().fire({icon:"error",title:"Error",text:"Hubo un error al eliminar la desparasitaci\xf3n.",confirmButtonText:"OK",heightAuto:!1})}}),function(){return c.apply(this,arguments)})}]})).present()})()}formatearFechaHora(e){if(!e)return"N/A";const t=new Date(e);return`${t.toLocaleDateString("es-PE")} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}`}exportarPDF(){var e;this.desparasitaciones&&0!==this.desparasitaciones.length?this.exportarpdf.exportarDesparasitaciones(this.desparasitaciones,null===(e=this.mascotaSeleccionada)||void 0===e?void 0:e.nombre,this.formatearFechaHora):h().fire({icon:"warning",title:"Sin historial",text:"No hay registros de desparasitaci\xf3n para exportar.",confirmButtonText:"OK",heightAuto:!1})}}return(n=l).\u0275fac=function(e){return new(e||n)(a.rXU(M),a.rXU(o.W3),a.rXU(o.hG),a.rXU(j.n),a.rXU(D.Xi))},n.\u0275cmp=a.VBU({type:n,selectors:[["app-desparasitacion"]],decls:15,vars:4,consts:[["cargando",""],["color","tertiary"],["slot","end"],[3,"click"],["name","download-outline","slot","start"],["name","add","slot","icon-only"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["lines","inset","button","","class","vacuna-item",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["lines","inset","button","",1,"vacuna-item",3,"click"],[1,"titulo"],[3,"ngClass"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash"],[1,"ion-text-center"],[1,"cargando-spinner"],["name","crescent"]],template:function(e,t){if(1&e){const i=a.RV6();a.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),a.EFF(3,"Desparasitaci\xf3n"),a.k0s(),a.j41(4,"ion-buttons",2)(5,"ion-button",3),a.bIt("click",function(){return a.eBV(i),a.Njj(t.exportarPDF())}),a.nrm(6,"ion-icon",4),a.EFF(7," Exportar PDF "),a.k0s(),a.j41(8,"ion-button",3),a.bIt("click",function(){return a.eBV(i),a.Njj(t.abrirModalDesparasitacion())}),a.nrm(9,"ion-icon",5),a.k0s()()()(),a.j41(10,"ion-content",6),a.DNE(11,T,3,2,"ion-list",7),a.nI1(12,"async"),a.DNE(13,$,4,0,"ng-template",null,0,a.C5r),a.k0s()}if(2&e){const i=a.sdS(14);a.R7$(11),a.Y8G("ngIf",a.bMT(12,2,t.desparasitaciones$))("ngIfElse",i)}},dependencies:[g.MD,g.YU,g.Sq,g.bT,g.Jj,g.PV,o.bv,o.Jm,o.QW,o.W9,o.eU,o.iq,o.uz,o.he,o.nf,o.w2,o.BC,o.ai,m.YN],styles:[".vacuna-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 8px;border-radius:12px;margin-bottom:10px;background:#f9f9f9;box-shadow:0 1px 4px #0000000d}.titulo[_ngcontent-%COMP%]{font-weight:700;font-size:1.1rem;margin-bottom:4px}.estado-aplicada[_ngcontent-%COMP%]{color:green}.estado-pendiente[_ngcontent-%COMP%]{color:red}.cargando-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:50px;color:#666}"]}),l})()}}]);