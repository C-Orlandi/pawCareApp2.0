"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4760],{4760:(L,k,g)=>{g.r(k),g.d(k,{RegistroMascotaPage:()=>J});var P=g(467),r=g(9417),l=g(3092),N=g(8032),b=g.n(N),x=g(9967),M=g(2881),C=g(7643);const R={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let v;const I=new Uint8Array(16),m=[];for(let t=0;t<256;++t)m.push((t+256).toString(16).slice(1));const O=function U(t,a,d){var n,e,i,c;if(R.randomUUID&&!a&&!t)return R.randomUUID();const s=null!==(n=null!==(e=(t=t||{}).random)&&void 0!==e?e:null===(i=(c=t).rng)||void 0===i?void 0:i.call(c))&&void 0!==n?n:function D(){if(!v){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");v=crypto.getRandomValues.bind(crypto)}return v(I)}();if(s.length<16)throw new Error("Random bytes length must be >= 16");if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,a){if((d=d||0)<0||d+16>a.length)throw new RangeError(`UUID byte range ${d}:${d+15} is out of buffer bounds`);for(let u=0;u<16;++u)a[d+u]=s[u];return a}return function j(t,a=0){return(m[t[a+0]]+m[t[a+1]]+m[t[a+2]]+m[t[a+3]]+"-"+m[t[a+4]]+m[t[a+5]]+"-"+m[t[a+6]]+m[t[a+7]]+"-"+m[t[a+8]]+m[t[a+9]]+"-"+m[t[a+10]]+m[t[a+11]]+m[t[a+12]]+m[t[a+13]]+m[t[a+14]]+m[t[a+15]]).toLowerCase()}(s)};var o=g(1360),y=g(5096),T=g(9506);function w(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este campo es obligatorio y debe tener al menos 2 caracteres."),o.k0s()())}function Y(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este campo es obligatorio y debe tener al menos 2 caracteres."),o.k0s()())}function z(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este campo es obligatorio y debe tener al menos 2 caracteres."),o.k0s()())}function S(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este camopo es obligatorio."),o.k0s()())}function G(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este camopo es obligatorio."),o.k0s()())}function $(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este camopo es obligatorio y debe tener al menos 3 caracteres.."),o.k0s()())}function V(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este camopo es obligatorio y solo permite numeros"),o.k0s()())}function A(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este camopo es obligatorio y solo permite numeros"),o.k0s()())}function X(t,a){1&t&&(o.j41(0,"ion-text",7)(1,"small"),o.EFF(2,"Este camopo es obligatorio"),o.k0s()())}function B(t,a){1&t&&(o.j41(0,"ion-item",5)(1,"ion-label"),o.EFF(2,"\xbfEsta especie tiene vacunas?"),o.k0s(),o.nrm(3,"ion-checkbox",25),o.k0s())}let J=(()=>{var t;class a{constructor(n,e,i,c,s,u,f,p){this.fb=n,this.loadingController=e,this.firestore=i,this.router=c,this.menuController=s,this.http=u,this.route=f,this.modalController=p,this.imagenFile=null,this.imagenPreview=null,this.modoEdicion=!1,this.midExistente=null,this.imagenAnterior=null,this.mascotaForm=this.fb.group({nombre:["",[r.k0.required,r.k0.minLength(2)]],tipo:["",[r.k0.required,r.k0.minLength(2)]],raza:["",[r.k0.required,r.k0.minLength(2)]],sexo:["",r.k0.required],fechaNacimiento:["",r.k0.required],color:["",[r.k0.required,r.k0.minLength(3)]],chip:["",[r.k0.required,r.k0.pattern("^[0-9]*$")]],peso:[null,[r.k0.required,r.k0.pattern("^[0-9]+(\\.[0-9]{1,2})?$")]],categoria:["",r.k0.required],tieneVacunas:[!1]})}ngOnInit(){this.menuController.enable(!0);const n=localStorage.getItem("usuarioLogin");n&&(this.usuarioLogin=JSON.parse(n))}ionViewWillEnter(){if("editar"===this.route.snapshot.queryParamMap.get("modo")){this.modoEdicion=!0;const e=localStorage.getItem("mascotaSeleccionada");if(e){const i=JSON.parse(e);this.midExistente=i.mid||null,this.imagenAnterior=i.imagen||null,this.mascotaForm.patchValue({nombre:i.nombre||"",tipo:i.tipo||"",raza:i.raza||"",sexo:i.sexo||"",fechaNacimiento:i.fechaNacimiento||"",color:i.color||"",chip:i.chip||"",peso:i.peso||"",categoria:i.categoria||"",tieneVacunas:i.tieneVacunas||!1}),i.imagen&&(this.imagenPreview=i.imagen)}}}onCategoriaChange(){var n;"exotico"!==(null===(n=this.mascotaForm.get("categoria"))||void 0===n?void 0:n.value)&&this.mascotaForm.patchValue({tieneVacunas:!1})}seleccionarImagen(n){const e=n.target.files[0];e&&(this.imagenFile=e)}calcularEdad(n){const e=new Date,i=new Date(n);let c=e.getFullYear()-i.getFullYear();const s=e.getMonth()-i.getMonth();return(s<0||0===s&&e.getDate()<i.getDate())&&c--,c}guardarMascota(){var n=this;return(0,P.A)(function*(){if(n.mascotaForm.invalid)return void b().fire({icon:"warning",title:"Formulario inv\xe1lido",text:"Por favor completa todos los campos correctamente.",confirmButtonText:"OK",heightAuto:!1});const e=yield n.loadingController.create({message:n.modoEdicion?"Actualizando mascota...":"Guardando mascota..."});yield e.present();try{var i,c,s;const u=n.mascotaForm.value,f=n.calcularEdad(u.fechaNacimiento),p=n.modoEdicion&&n.midExistente?n.midExistente:O();let F=n.imagenAnterior||"";if(n.imagenFile){const E=new FormData;E.append("foto",n.imagenFile),F=(yield n.http.post("http://localhost:3000/upload",E).toPromise()).url}const h={mid:p,...u,edad:f,imagen:F,usuarioUid:(null===(i=n.usuarioLogin)||void 0===i?void 0:i.uid)||"desconocido",dueno:{nombre:(null===(c=n.usuarioLogin)||void 0===c?void 0:c.nombre)||"No registrado",contacto:(null===(s=n.usuarioLogin)||void 0===s?void 0:s.contacto)||"No registrado"}};yield(0,x.BN)((0,x.H9)(n.firestore,"mascotas",p),h),yield e.dismiss(),localStorage.setItem("mascotaSeleccionada",JSON.stringify(h)),b().fire({icon:"success",title:n.modoEdicion?"Actualizaci\xf3n Exitosa":"Registro Exitoso",text:n.modoEdicion?"La informaci\xf3n de la mascota fue actualizada correctamente.":"Mascota registrada correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>{n.router.navigate(["/mis-mascotas"])})}catch(u){console.error("Error al guardar la mascota:",u),yield e.dismiss(),b().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al guardar la mascota.",confirmButtonText:"OK",heightAuto:!1})}})()}cerrar(){this.router.navigate(["/mis-mascotas"])}}return(t=a).\u0275fac=function(n){return new(n||t)(o.rXU(r.ok),o.rXU(l.Xi),o.rXU(x._7),o.rXU(y.Ix),o.rXU(l._t),o.rXU(C.Qq),o.rXU(y.nX),o.rXU(T.W3))},t.\u0275cmp=o.VBU({type:t,selectors:[["app-registro-mascota"]],decls:87,vars:14,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","nombre"],["color","danger",4,"ngIf"],["formControlName","tipo"],["formControlName","raza"],["formControlName","sexo","placeholder","Seleccionar..."],["value","Macho"],["value","Hembra"],["formControlName","fechaNacimiento","presentation","date","max","2025-12-31","display-format","DD/MM/YYYY"],["formControlName","color"],["formControlName","chip"],["formControlName","peso","type","number"],["formControlName","categoria","placeholder","Seleccionar...",3,"ionChange"],["value","domestico"],["value","exotico"],["lines","inset",4,"ngIf"],["type","file","accept","image/*",3,"change"],["expand","block","shape","round","size","large","color","dark","type","submit",1,"ion-margin-top",3,"disabled"],["formControlName","tieneVacunas","slot","start"]],template:function(n,e){if(1&n&&(o.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),o.EFF(3),o.k0s(),o.j41(4,"ion-buttons",1)(5,"ion-button",2),o.bIt("click",function(){return e.cerrar()}),o.EFF(6,"Cerrar"),o.k0s()()()(),o.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),o.bIt("ngSubmit",function(){return e.guardarMascota()}),o.j41(11,"ion-item",5)(12,"ion-label",6),o.EFF(13,"Nombre "),o.j41(14,"ion-text",7),o.EFF(15,"*"),o.k0s()(),o.nrm(16,"ion-input",8),o.k0s(),o.DNE(17,w,3,0,"ion-text",9),o.j41(18,"ion-item",5)(19,"ion-label",6),o.EFF(20,"Especie "),o.j41(21,"ion-text",7),o.EFF(22,"*"),o.k0s()(),o.nrm(23,"ion-input",10),o.k0s(),o.DNE(24,Y,3,0,"ion-text",9),o.j41(25,"ion-item",5)(26,"ion-label",6),o.EFF(27,"Raza "),o.j41(28,"ion-text",7),o.EFF(29,"*"),o.k0s()(),o.nrm(30,"ion-input",11),o.k0s(),o.DNE(31,z,3,0,"ion-text",9),o.j41(32,"ion-item",5)(33,"ion-label",6),o.EFF(34,"Sexo "),o.j41(35,"ion-text",7),o.EFF(36,"*"),o.k0s()(),o.j41(37,"ion-select",12)(38,"ion-select-option",13),o.EFF(39,"Macho"),o.k0s(),o.j41(40,"ion-select-option",14),o.EFF(41,"Hembra"),o.k0s()()(),o.DNE(42,S,3,0,"ion-text",9),o.j41(43,"ion-item",5)(44,"ion-label",6),o.EFF(45,"Fecha de Nacimiento "),o.j41(46,"ion-text",7),o.EFF(47,"*"),o.k0s()(),o.nrm(48,"ion-datetime",15),o.k0s(),o.DNE(49,G,3,0,"ion-text",9),o.j41(50,"ion-item",5)(51,"ion-label",6),o.EFF(52,"Color "),o.j41(53,"ion-text",7),o.EFF(54,"*"),o.k0s()(),o.nrm(55,"ion-input",16),o.k0s(),o.DNE(56,$,3,0,"ion-text",9),o.j41(57,"ion-item",5)(58,"ion-label",6),o.EFF(59,"N\xfamero de chip / identificaci\xf3n "),o.j41(60,"ion-text",7),o.EFF(61,"*"),o.k0s()(),o.nrm(62,"ion-input",17),o.k0s(),o.DNE(63,V,3,0,"ion-text",9),o.j41(64,"ion-item",5)(65,"ion-label",6),o.EFF(66,"Peso (kg) o (g)"),o.k0s(),o.nrm(67,"ion-input",18),o.k0s(),o.DNE(68,A,3,0,"ion-text",9),o.j41(69,"ion-item",5)(70,"ion-label"),o.EFF(71,"Categor\xeda "),o.j41(72,"ion-text",7),o.EFF(73,"*"),o.k0s()(),o.j41(74,"ion-select",19),o.bIt("ionChange",function(){return e.onCategoriaChange()}),o.j41(75,"ion-select-option",20),o.EFF(76,"Dom\xe9stico"),o.k0s(),o.j41(77,"ion-select-option",21),o.EFF(78,"Ex\xf3tico"),o.k0s()()(),o.DNE(79,X,3,0,"ion-text",9)(80,B,4,0,"ion-item",22),o.j41(81,"ion-item",5)(82,"ion-label"),o.EFF(83,"Foto de la mascota"),o.k0s(),o.j41(84,"input",23),o.bIt("change",function(c){return e.seleccionarImagen(c)}),o.k0s()(),o.j41(85,"ion-button",24),o.EFF(86),o.k0s()()()()()),2&n){let i,c,s,u,f,p,F,h,E,_;o.R7$(3),o.JRh(e.modoEdicion?"Editar Mascota":"Registrar Mascota"),o.R7$(7),o.Y8G("formGroup",e.mascotaForm),o.R7$(7),o.Y8G("ngIf",(null==(i=e.mascotaForm.get("nombre"))?null:i.invalid)&&(null==(i=e.mascotaForm.get("nombre"))?null:i.touched)),o.R7$(7),o.Y8G("ngIf",(null==(c=e.mascotaForm.get("tipo"))?null:c.invalid)&&(null==(c=e.mascotaForm.get("tipo"))?null:c.touched)),o.R7$(7),o.Y8G("ngIf",(null==(s=e.mascotaForm.get("raza"))?null:s.invalid)&&(null==(s=e.mascotaForm.get("raza"))?null:s.touched)),o.R7$(11),o.Y8G("ngIf",(null==(u=e.mascotaForm.get("sexo"))?null:u.invalid)&&(null==(u=e.mascotaForm.get("sexo"))?null:u.touched)),o.R7$(7),o.Y8G("ngIf",(null==(f=e.mascotaForm.get("fechaNacimiento"))?null:f.invalid)&&(null==(f=e.mascotaForm.get("fechaNacimiento"))?null:f.touched)),o.R7$(7),o.Y8G("ngIf",(null==(p=e.mascotaForm.get("color"))?null:p.invalid)&&(null==(p=e.mascotaForm.get("color"))?null:p.touched)),o.R7$(7),o.Y8G("ngIf",(null==(F=e.mascotaForm.get("chip"))?null:F.invalid)&&(null==(F=e.mascotaForm.get("chip"))?null:F.touched)),o.R7$(5),o.Y8G("ngIf",(null==(h=e.mascotaForm.get("peso"))?null:h.invalid)&&(null==(h=e.mascotaForm.get("peso"))?null:h.touched)),o.R7$(11),o.Y8G("ngIf",(null==(E=e.mascotaForm.get("chip"))?null:E.invalid)&&(null==(E=e.mascotaForm.get("chip"))?null:E.touched)),o.R7$(),o.Y8G("ngIf","exotico"===(null==(_=e.mascotaForm.get("categoria"))?null:_.value)),o.R7$(5),o.Y8G("disabled",e.mascotaForm.invalid),o.R7$(),o.SpI(" ",e.modoEdicion?"Guardar Cambios":"Registrar Mascota"," ")}},dependencies:[M.MD,M.bT,l.bv,l.Jm,l.QW,l.b_,l.I9,l.eY,l.W9,l.A9,l.eU,l.$w,l.uz,l.he,l.Nm,l.Ip,l.IO,l.BC,l.ai,l.hB,l.su,l.Je,l.Gw,r.YN,r.qT,r.BC,r.cb,r.X1,r.j4,r.JD,C.q1],styles:[".registro-mascota[_ngcontent-%COMP%]{--background: #f7f9fc}.form-card[_ngcontent-%COMP%]{border-radius:16px;box-shadow:0 6px 12px #0000000d;margin-bottom:30px}ion-item[_ngcontent-%COMP%]{--border-radius: 12px;margin-bottom:12px}ion-label[_ngcontent-%COMP%]{font-size:1rem;font-weight:500;color:#333}ion-input[_ngcontent-%COMP%], ion-datetime[_ngcontent-%COMP%]{font-size:1rem}.boton-registrar[_ngcontent-%COMP%]{margin-top:20px;border-radius:12px;font-size:1rem;--box-shadow: 0px 4px 10px rgba(0, 0, 0, .15)}.emoji-selector[_ngcontent-%COMP%]{margin-top:20px}.emoji-selector[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500;color:#666}.emoji-selector[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}.emoji-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:22px;padding:6px 12px;border-radius:50%;background-color:#eee;border:1px solid transparent;cursor:pointer;transition:background .3s}.emoji-selector[_ngcontent-%COMP%]   .selected[_ngcontent-%COMP%]{background-color:#3880ff;color:#fff;border-color:#3880ff}.preview-img[_ngcontent-%COMP%]{max-height:200px;object-fit:contain;margin:auto}ion-button[_ngcontent-%COMP%]{margin-top:12px;font-size:15px;letter-spacing:.5px;border-radius:12px}"]}),a})()}}]);