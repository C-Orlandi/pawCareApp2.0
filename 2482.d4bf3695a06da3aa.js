"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2482],{2482:(q,E,m)=>{m.r(E),m.d(E,{HistorialPage:()=>Q});var F=m(467),f=m(2881),s=m(3092),h=m(3273),p=m(9967),l=m(9417),j=m(8032),u=m.n(j),t=m(1360),x=m(9506);function C(e,a){1&e&&(t.j41(0,"ion-text",7)(1,"p",16),t.EFF(2,"La fecha es obligatoria."),t.k0s()())}function v(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Debe tener al menos 3 letras."),t.k0s())}function $(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Solo letras y espacios."),t.k0s())}function I(e,a){if(1&e&&(t.j41(0,"ion-text",7),t.DNE(1,v,2,0,"p",17)(2,$,2,0,"p",17),t.k0s()),2&e){let n,o;const i=t.XpG();t.R7$(),t.Y8G("ngIf",null==(n=i.registroForm.get("motivo"))?null:n.hasError("minlength")),t.R7$(),t.Y8G("ngIf",null==(o=i.registroForm.get("motivo"))?null:o.hasError("pattern"))}}function b(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Debe tener al menos 3 letras."),t.k0s())}function y(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Solo letras y espacios."),t.k0s())}function M(e,a){if(1&e&&(t.j41(0,"ion-text",7),t.DNE(1,b,2,0,"p",17)(2,y,2,0,"p",17),t.k0s()),2&e){let n,o;const i=t.XpG();t.R7$(),t.Y8G("ngIf",null==(n=i.registroForm.get("veterinario"))?null:n.hasError("minlength")),t.R7$(),t.Y8G("ngIf",null==(o=i.registroForm.get("veterinario"))?null:o.hasError("pattern"))}}function T(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Este campo es obligatorio."),t.k0s())}function G(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Debe tener al menos 3 letras."),t.k0s())}function D(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Solo letras y espacios."),t.k0s())}function S(e,a){if(1&e&&(t.j41(0,"ion-text",7),t.DNE(1,T,2,0,"p",17)(2,G,2,0,"p",17)(3,D,2,0,"p",17),t.k0s()),2&e){let n,o,i;const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==(n=r.registroForm.get("diagnostico"))?null:n.hasError("required")),t.R7$(),t.Y8G("ngIf",null==(o=r.registroForm.get("diagnostico"))?null:o.hasError("minlength")),t.R7$(),t.Y8G("ngIf",null==(i=r.registroForm.get("diagnostico"))?null:i.hasError("pattern"))}}function N(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Debe tener al menos 3 caracteres."),t.k0s())}function P(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Solo letras, n\xfameros y signos permitidos."),t.k0s())}function Y(e,a){if(1&e&&(t.j41(0,"ion-text",7),t.DNE(1,N,2,0,"p",17)(2,P,2,0,"p",17),t.k0s()),2&e){let n,o;const i=t.XpG();t.R7$(),t.Y8G("ngIf",null==(n=i.registroForm.get("tratamiento"))?null:n.hasError("minlength")),t.R7$(),t.Y8G("ngIf",null==(o=i.registroForm.get("tratamiento"))?null:o.hasError("pattern"))}}function X(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Este campo es obligatorio."),t.k0s())}function H(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Debe tener al menos 3 caracteres."),t.k0s())}function A(e,a){1&e&&(t.j41(0,"p",16),t.EFF(1,"Solo letras, n\xfameros y signos permitidos."),t.k0s())}function O(e,a){if(1&e&&(t.j41(0,"ion-text",7),t.DNE(1,X,2,0,"p",17)(2,H,2,0,"p",17)(3,A,2,0,"p",17),t.k0s()),2&e){let n,o,i;const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==(n=r.registroForm.get("medicamentos"))?null:n.hasError("required")),t.R7$(),t.Y8G("ngIf",null==(o=r.registroForm.get("medicamentos"))?null:o.hasError("minlength")),t.R7$(),t.Y8G("ngIf",null==(i=r.registroForm.get("medicamentos"))?null:i.hasError("pattern"))}}let R=(()=>{var e;class a{constructor(o,i,r,c,d){this.fb=o,this.firestore=i,this.toastController=r,this.modalController=c,this.loadingController=d,this.hoy=(new Date).toISOString(),this.registroForm=this.fb.group({fechaVisita:[this.hoy,l.k0.required],motivo:["",[l.k0.minLength(3),l.k0.pattern("^[a-zA-Z\xc1\xc9\xcd\xd3\xda\xe1\xe9\xed\xf3\xfa\xf1\xd1 ]*$")]],veterinario:["",[l.k0.minLength(3),l.k0.pattern("^[a-zA-Z\xc1\xc9\xcd\xd3\xda\xe1\xe9\xed\xf3\xfa\xf1\xd1 ]*$")]],diagnostico:["",[l.k0.required,l.k0.minLength(3),l.k0.pattern("^[a-zA-Z\xc1\xc9\xcd\xd3\xda\xe1\xe9\xed\xf3\xfa\xf1\xd1 ]*$")]],tratamiento:["",[l.k0.minLength(3),l.k0.pattern("^[a-zA-Z\xc1\xc9\xcd\xd3\xda\xe1\xe9\xed\xf3\xfa\xf1\xd10-9 ,.()\\n\\r-]*$")]],medicamentos:["",[l.k0.required,l.k0.minLength(3),l.k0.pattern("^[a-zA-Z\xc1\xc9\xcd\xd3\xda\xe1\xe9\xed\xf3\xfa\xf1\xd10-9 ,.()\\n\\r-]*$")]]})}ngOnInit(){const o=localStorage.getItem("mascotaSeleccionada");o&&(this.mascotaSeleccionada=JSON.parse(o)),this.registro&&this.registroForm.patchValue(this.registro)}guardarRegistro(){var o=this;return(0,F.A)(function*(){var i;if(o.registroForm.invalid||!o.mascotaSeleccionada)return void u().fire({icon:"warning",title:"Formulario inv\xe1lido",text:"Por favor completa todos los campos correctamente.",confirmButtonText:"OK",heightAuto:!1});const r=yield o.loadingController.create({message:"Cargando...",spinner:"circles"});yield r.present();const c=o.registroForm.value;if(null!==(i=o.registro)&&void 0!==i&&i.rid){const g={...c,mid:o.mascotaSeleccionada.mid,creadoEn:o.registro.creadoEn||new Date};try{const _=(0,p.H9)(o.firestore,"registrosMedicos",o.registro.rid);yield(0,p.mZ)(_,g),yield r.dismiss(),u().fire({icon:"success",title:"Registro Actualizado",text:"El registro m\xe9dico fue actualizado correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>o.modalController.dismiss(!0))}catch(_){console.error("Error al actualizar:",_),yield r.dismiss(),o.mostrarMensajeDeError()}return}const d={...c,mid:o.mascotaSeleccionada.mid,creadoEn:new Date};try{const g=yield(0,p.gS)((0,p.rJ)(o.firestore,"registrosMedicos"),d);yield(0,p.mZ)((0,p.H9)(o.firestore,"registrosMedicos",g.id),{rid:g.id}),yield r.dismiss(),u().fire({icon:"success",title:"Registro Exitoso",text:"Registro m\xe9dico guardado correctamente.",confirmButtonText:"OK",heightAuto:!1}).then(()=>o.modalController.dismiss(!0))}catch(g){console.error("Error al guardar:",g),yield r.dismiss(),o.mostrarMensajeDeError()}})()}mostrarMensajeDeError(){u().fire({icon:"error",title:"Error",text:"Hubo un problema al guardar el registro. Intenta nuevamente.",confirmButtonText:"OK",heightAuto:!1})}cerrar(){this.modalController.dismiss(!1)}}return(e=a).\u0275fac=function(o){return new(o||e)(t.rXU(l.ok),t.rXU(p._7),t.rXU(s.K_),t.rXU(x.W3),t.rXU(s.Xi))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-modal-rmedico"]],inputs:{registro:"registro"},decls:55,vars:9,consts:[["color","tertiary"],["slot","end"],[3,"click"],[1,"ion-padding"],[3,"ngSubmit","formGroup"],["lines","inset"],["position","floating"],["color","danger"],["formControlName","fechaVisita","presentation","date",3,"max"],["color","danger",4,"ngIf"],["formControlName","motivo"],["formControlName","veterinario"],["formControlName","diagnostico"],["formControlName","tratamiento"],["formControlName","medicamentos"],["expand","block","shape","round","size","large","type","submit","color","dark",1,"ion-margin-top"],[1,"ion-padding-start"],["class","ion-padding-start",4,"ngIf"]],template:function(o,i){if(1&o&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),t.EFF(3,"Registro M\xe9dico Personal"),t.k0s(),t.j41(4,"ion-buttons",1)(5,"ion-button",2),t.bIt("click",function(){return i.cerrar()}),t.EFF(6,"Cerrar"),t.k0s()()()(),t.j41(7,"ion-content",3)(8,"ion-card")(9,"ion-card-content")(10,"form",4),t.bIt("ngSubmit",function(){return i.guardarRegistro()}),t.j41(11,"ion-item",5)(12,"ion-label",6),t.EFF(13,"Fecha de visita "),t.j41(14,"ion-text",7),t.EFF(15,"*"),t.k0s()(),t.nrm(16,"ion-datetime",8),t.k0s(),t.DNE(17,C,3,0,"ion-text",9),t.j41(18,"ion-item",5)(19,"ion-label",6),t.EFF(20,"Motivo de la visita "),t.j41(21,"ion-text",7),t.EFF(22,"*"),t.k0s()(),t.nrm(23,"ion-input",10),t.k0s(),t.DNE(24,I,3,2,"ion-text",9),t.j41(25,"ion-item",5)(26,"ion-label",6),t.EFF(27,"Veterinario(a) "),t.j41(28,"ion-text",7),t.EFF(29,"*"),t.k0s()(),t.nrm(30,"ion-input",11),t.k0s(),t.DNE(31,M,3,2,"ion-text",9),t.j41(32,"ion-item",5)(33,"ion-label",6),t.EFF(34,"Diagn\xf3stico "),t.j41(35,"ion-text",7),t.EFF(36,"*"),t.k0s()(),t.nrm(37,"ion-textarea",12),t.k0s(),t.DNE(38,S,4,3,"ion-text",9),t.j41(39,"ion-item",5)(40,"ion-label",6),t.EFF(41,"Tratamiento / Recomendaciones "),t.j41(42,"ion-text",7),t.EFF(43,"*"),t.k0s()(),t.nrm(44,"ion-textarea",13),t.k0s(),t.DNE(45,Y,3,2,"ion-text",9),t.j41(46,"ion-item",5)(47,"ion-label",6),t.EFF(48,"Medicamentos indicados "),t.j41(49,"ion-text",7),t.EFF(50,"*"),t.k0s()(),t.nrm(51,"ion-textarea",14),t.k0s(),t.DNE(52,O,4,3,"ion-text",9),t.j41(53,"ion-button",15),t.EFF(54),t.k0s()()()()()),2&o){let r,c,d,g,_,k;t.R7$(10),t.Y8G("formGroup",i.registroForm),t.R7$(6),t.Y8G("max",i.hoy),t.R7$(),t.Y8G("ngIf",(null==(r=i.registroForm.get("fechaVisita"))?null:r.touched)&&(null==(r=i.registroForm.get("fechaVisita"))?null:r.hasError("required"))),t.R7$(7),t.Y8G("ngIf",null==(c=i.registroForm.get("motivo"))?null:c.touched),t.R7$(7),t.Y8G("ngIf",null==(d=i.registroForm.get("veterinario"))?null:d.touched),t.R7$(7),t.Y8G("ngIf",null==(g=i.registroForm.get("diagnostico"))?null:g.touched),t.R7$(7),t.Y8G("ngIf",(null==(_=i.registroForm.get("tratamiento"))?null:_.touched)&&(null==(_=i.registroForm.get("tratamiento"))?null:_.value)),t.R7$(7),t.Y8G("ngIf",null==(k=i.registroForm.get("medicamentos"))?null:k.touched),t.R7$(2),t.SpI(" ",i.registro?"Actualizar":"Guardar"," Registro ")}},dependencies:[f.MD,f.bT,s.bv,s.Jm,s.QW,s.b_,s.I9,s.W9,s.A9,s.eU,s.$w,s.uz,s.he,s.IO,s.nc,s.BC,s.ai,s.Je,s.Gw,l.X1,l.qT,l.BC,l.cb,l.j4,l.JD],styles:["ion-button[_ngcontent-%COMP%]{margin-top:12px;font-size:15px;letter-spacing:.5px;border-radius:12px}"]}),a})();var V=m(5391);function B(e,a){if(1&e&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Veterinario:"),t.k0s(),t.EFF(3),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(3),t.SpI(" ",n.veterinario,"")}}function U(e,a){if(1&e&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Diagn\xf3stico:"),t.k0s(),t.EFF(3),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(3),t.SpI(" ",n.diagnostico,"")}}function z(e,a){if(1&e&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Tratamiento:"),t.k0s(),t.EFF(3),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(3),t.SpI(" ",n.tratamiento,"")}}function J(e,a){if(1&e&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Medicamentos:"),t.k0s(),t.EFF(3),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(3),t.SpI(" ",n.medicamentos,"")}}function K(e,a){if(1&e&&(t.j41(0,"p")(1,"strong"),t.EFF(2,"Notas:"),t.k0s(),t.EFF(3),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(3),t.SpI(" ",n.notas,"")}}function L(e,a){if(1&e){const n=t.RV6();t.j41(0,"ion-item",10),t.bIt("click",function(){const i=t.eBV(n).$implicit,r=t.XpG(2);return t.Njj(r.editarRegistro(i))}),t.j41(1,"ion-label")(2,"h2"),t.EFF(3),t.k0s(),t.j41(4,"p")(5,"strong"),t.EFF(6,"Motivo:"),t.k0s(),t.EFF(7),t.k0s(),t.DNE(8,B,4,1,"p",9)(9,U,4,1,"p",9)(10,z,4,1,"p",9)(11,J,4,1,"p",9)(12,K,4,1,"p",9),t.k0s(),t.j41(13,"ion-button",11),t.bIt("click",function(i){const r=t.eBV(n).$implicit;return t.XpG(2).eliminarRegistro(r.rid),t.Njj(i.stopPropagation())}),t.nrm(14,"ion-icon",12),t.k0s()()}if(2&e){const n=a.$implicit,o=t.XpG(2);t.R7$(3),t.JRh(o.formatearFecha(n.fechaVisita)),t.R7$(4),t.SpI(" ",n.motivo,""),t.R7$(),t.Y8G("ngIf",n.veterinario),t.R7$(),t.Y8G("ngIf",n.diagnostico),t.R7$(),t.Y8G("ngIf",n.tratamiento),t.R7$(),t.Y8G("ngIf",n.medicamentos),t.R7$(),t.Y8G("ngIf",n.notas)}}function W(e,a){1&e&&(t.j41(0,"ion-item")(1,"ion-label",13),t.EFF(2,"No hay registros m\xe9dicos."),t.k0s()())}function Z(e,a){if(1&e&&(t.j41(0,"ion-list"),t.DNE(1,L,15,7,"ion-item",8)(2,W,3,0,"ion-item",9),t.k0s()),2&e){const n=a.ngIf;t.R7$(),t.Y8G("ngForOf",n),t.R7$(),t.Y8G("ngIf",0===n.length)}}function w(e,a){1&e&&(t.j41(0,"div",14),t.nrm(1,"ion-spinner",15),t.j41(2,"p",13),t.EFF(3,"Cargando historial m\xe9dico..."),t.k0s()())}let Q=(()=>{var e;class a{constructor(o,i,r,c,d){this.firestore=o,this.modalController=i,this.alertController=r,this.exportarpdf=c,this.loadingController=d,this.registros=[]}ngOnInit(){const o=localStorage.getItem("mascotaSeleccionada");o&&(this.mascotaSeleccionada=JSON.parse(o),this.cargarRegistros())}cargarRegistros(){var o;const i=(0,h.rJ)(this.firestore,"registrosMedicos"),r=(0,h.P)(i,(0,h._M)("mid","==",null===(o=this.mascotaSeleccionada)||void 0===o?void 0:o.mid),(0,h.My)("fechaVisita","desc"));this.registros$=(0,p.xs)(r,{idField:"rid"}),this.registros$.subscribe(c=>this.registros=c)}abrirModalRegistro(){var o=this;return(0,F.A)(function*(){const i=yield o.modalController.create({component:R,componentProps:{mid:o.mascotaSeleccionada.mid}});i.onDidDismiss().then(r=>{r.data&&o.cargarRegistros()}),yield i.present()})()}editarRegistro(o){var i=this;return(0,F.A)(function*(){const r=yield i.modalController.create({component:R,componentProps:{registro:o}});r.onDidDismiss().then(c=>{c.data&&i.cargarRegistros()}),yield r.present()})()}eliminarRegistro(o){var i=this;return(0,F.A)(function*(){var c;yield(yield i.alertController.create({header:"Eliminar",message:"\xbfEst\xe1s seguro de eliminar este registro?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:(c=(0,F.A)(function*(){const d=yield i.loadingController.create({message:"Eliminando...",spinner:"circles"});yield d.present();try{yield(0,h.kd)((0,h.H9)(i.firestore,"registrosMedicos",o)),i.cargarRegistros(),yield d.dismiss(),u().fire({icon:"success",title:"Registro eliminado",text:"El historial m\xe9dico fue eliminado correctamente.",confirmButtonText:"OK",heightAuto:!1})}catch(g){yield d.dismiss(),u().fire({icon:"error",title:"Error",text:"Ocurri\xf3 un error al eliminar el registro.",confirmButtonText:"OK",heightAuto:!1}),console.error("\u274c Error eliminando registro:",g)}}),function(){return c.apply(this,arguments)})}]})).present()})()}formatearFecha(o){return o?new Date(o).toLocaleDateString("es-CL"):"N/A"}exportarPDF(){var o;this.registros&&0!==this.registros.length?this.exportarpdf.exportarHistorialMedico(this.registros,null===(o=this.mascotaSeleccionada)||void 0===o?void 0:o.nombre,this.formatearFecha):u().fire({icon:"info",title:"Sin historial m\xe9dico",text:"No hay registros para exportar.",confirmButtonText:"OK",heightAuto:!1})}}return(e=a).\u0275fac=function(o){return new(o||e)(t.rXU(p._7),t.rXU(s.W3),t.rXU(s.hG),t.rXU(V.n),t.rXU(x.Xi))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-historial"]],decls:15,vars:4,consts:[["cargando",""],["color","tertiary"],["slot","end"],[3,"click"],["name","download-outline","slot","start"],["name","add","slot","icon-only"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],["lines","inset","button","",3,"click",4,"ngFor","ngForOf"],[4,"ngIf"],["lines","inset","button","",3,"click"],["fill","clear","color","danger","slot","end",3,"click"],["name","trash"],[1,"ion-text-center"],[1,"cargando-spinner"],["name","crescent","color","primary"]],template:function(o,i){if(1&o){const r=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-title"),t.EFF(3,"Historial M\xe9dico"),t.k0s(),t.j41(4,"ion-buttons",2)(5,"ion-button",3),t.bIt("click",function(){return t.eBV(r),t.Njj(i.exportarPDF())}),t.nrm(6,"ion-icon",4),t.EFF(7," Exportar PDF "),t.k0s(),t.j41(8,"ion-button",3),t.bIt("click",function(){return t.eBV(r),t.Njj(i.abrirModalRegistro())}),t.nrm(9,"ion-icon",5),t.k0s()()()(),t.j41(10,"ion-content",6),t.DNE(11,Z,3,2,"ion-list",7),t.nI1(12,"async"),t.DNE(13,w,4,0,"ng-template",null,0,t.C5r),t.k0s()}if(2&o){const r=t.sdS(14);t.R7$(11),t.Y8G("ngIf",t.bMT(12,2,i.registros$))("ngIfElse",r)}},dependencies:[f.MD,f.Sq,f.bT,f.Jj,s.bv,s.Jm,s.QW,s.W9,s.eU,s.iq,s.uz,s.he,s.nf,s.w2,s.BC,s.ai],styles:[".cargando-spinner[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;text-align:center}"]}),a})()}}]);