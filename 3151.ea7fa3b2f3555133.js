"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3151],{3151:(M,c,o)=>{o.r(c),o.d(c,{PerfilUsuarioPage:()=>E});var s=o(467),t=o(3092),h=o(2881),u=o(9417),e=o(1360),p=o(6973),P=o(8570),f=o(4796),C=o(5096);let E=(()=>{var l;class _{constructor(i,a,n,r,d,m){this.auth=i,this.usuarioService=a,this.authService=n,this.router=r,this.alertCtrl=d,this.loadingCtrl=m,this.nombre="",this.email="",this.password="",this.contacto=""}ngOnInit(){var i=this;return(0,s.A)(function*(){var a,n;i.usuarioAuth=null!==(a=i.auth.currentUser)&&void 0!==a?a:void 0,i.usuarioAuth?(i.email=null!==(n=i.usuarioAuth.email)&&void 0!==n?n:"",i.usuarioService.getUsuarioPorUid(i.usuarioAuth.uid).subscribe(r=>{r&&(i.usuarioData=r,i.nombre=r.nombre||"",i.contacto=r.contacto||"")})):i.router.navigate(["/login"])})()}guardarCambios(){var i=this;return(0,s.A)(function*(){if(!i.usuarioAuth||!i.usuarioData)return;const a=yield i.loadingCtrl.create({message:"Guardando cambios..."});yield a.present();try{yield i.usuarioService.actualizarPerfil({uid:i.usuarioAuth.uid,email:i.email,password:i.password.trim(),nombre:i.nombre,contacto:i.contacto}).toPromise(),yield a.dismiss(),yield(yield i.alertCtrl.create({header:"\xc9xito",message:"Perfil actualizado correctamente.",buttons:["OK"]})).present(),i.email!==i.usuarioAuth.email&&(yield i.auth.signOut(),i.router.navigate(["/login"]))}catch(n){yield a.dismiss(),yield(yield i.alertCtrl.create({header:"Error",message:"No se pudo actualizar el perfil: "+n,buttons:["OK"]})).present()}})()}eliminarCuenta(){var i=this;return(0,s.A)(function*(){var n;yield(yield i.alertCtrl.create({header:"Confirmar eliminaci\xf3n",message:"\xbfSeguro que quieres eliminar tu cuenta? Esta acci\xf3n no se puede deshacer.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",handler:(n=(0,s.A)(function*(){if(!i.usuarioAuth)return;const r=yield i.loadingCtrl.create({message:"Eliminando cuenta..."});yield r.present();try{yield i.usuarioService.eliminarUsuarioPerfil(i.usuarioAuth.uid),yield r.dismiss(),yield i.auth.signOut(),i.router.navigate(["/login"])}catch(d){yield r.dismiss(),yield(yield i.alertCtrl.create({header:"Error",message:"No se pudo eliminar la cuenta: "+d,buttons:["OK"]})).present()}}),function(){return n.apply(this,arguments)})}]})).present()})()}}return(l=_).\u0275fac=function(i){return new(i||l)(e.rXU(p.Nj),e.rXU(P.d),e.rXU(f.u),e.rXU(C.Ix),e.rXU(t.hG),e.rXU(t.Xi))},l.\u0275cmp=e.VBU({type:l,selectors:[["app-perfil-usuario"]],decls:25,vars:4,consts:[["color","tertiary"],[1,"ion-padding"],["position","floating"],["type","text",3,"ngModelChange","ngModel"],["type","email",3,"ngModelChange","ngModel"],["type","password","placeholder","Deja vac\xedo para no cambiar",3,"ngModelChange","ngModel"],["type","tel",3,"ngModelChange","ngModel"],["expand","block",3,"click"],["expand","block","color","danger",3,"click"]],template:function(i,a){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e.EFF(3,"Mi Perfil"),e.k0s()()(),e.j41(4,"ion-content",1)(5,"ion-item")(6,"ion-label",2),e.EFF(7,"Nombre"),e.k0s(),e.j41(8,"ion-input",3),e.mxI("ngModelChange",function(r){return e.DH7(a.nombre,r)||(a.nombre=r),r}),e.k0s()(),e.j41(9,"ion-item")(10,"ion-label",2),e.EFF(11,"Email"),e.k0s(),e.j41(12,"ion-input",4),e.mxI("ngModelChange",function(r){return e.DH7(a.email,r)||(a.email=r),r}),e.k0s()(),e.j41(13,"ion-item")(14,"ion-label",2),e.EFF(15,"Nuevo Password"),e.k0s(),e.j41(16,"ion-input",5),e.mxI("ngModelChange",function(r){return e.DH7(a.password,r)||(a.password=r),r}),e.k0s()(),e.j41(17,"ion-item")(18,"ion-label",2),e.EFF(19,"Contacto"),e.k0s(),e.j41(20,"ion-input",6),e.mxI("ngModelChange",function(r){return e.DH7(a.contacto,r)||(a.contacto=r),r}),e.k0s()(),e.j41(21,"ion-button",7),e.bIt("click",function(){return a.guardarCambios()}),e.EFF(22,"Guardar Cambios"),e.k0s(),e.j41(23,"ion-button",8),e.bIt("click",function(){return a.eliminarCuenta()}),e.EFF(24,"Eliminar Cuenta"),e.k0s()()),2&i&&(e.R7$(8),e.R50("ngModel",a.nombre),e.R7$(4),e.R50("ngModel",a.email),e.R7$(4),e.R50("ngModel",a.password),e.R7$(4),e.R50("ngModel",a.contacto))},dependencies:[h.MD,t.bv,t.Jm,t.W9,t.eU,t.$w,t.uz,t.he,t.BC,t.ai,t.Gw,u.X1,u.BC,u.YN,u.vS],encapsulation:2}),_})()}}]);